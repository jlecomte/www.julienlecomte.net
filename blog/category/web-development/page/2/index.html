<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) & !(IE 8)]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>Web Development | Julien Lecomte&#039;s Blog | Page 2</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="http://www.julienlecomte.net/blog/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="http://www.julienlecomte.net/blog/wp-content/themes/twentytwelve/js/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel="alternate" type="application/rss+xml" title="Julien Lecomte&#039;s Blog &raquo; Feed" href="../../../../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Julien Lecomte&#039;s Blog &raquo; Comments Feed" href="../../../../comments/feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Julien Lecomte&#039;s Blog &raquo; Web Development Category Feed" href="../../feed/index.html" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"http:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/www.julienlecomte.net\/blog\/wp-includes\/js\/wp-emoji-release.min.js"}};
			!function(a,b,c){function d(a){var c=b.createElement("canvas"),d=c.getContext&&c.getContext("2d");return d&&d.fillText?(d.textBaseline="top",d.font="600 32px Arial","flag"===a?(d.fillText(String.fromCharCode(55356,56812,55356,56807),0,0),c.toDataURL().length>3e3):(d.fillText(String.fromCharCode(55357,56835),0,0),0!==d.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='colorbox-theme1-css'  href='../../../../wp-content/plugins/jquery-lightbox-for-native-galleries/colorbox/theme1/colorbox.css' type='text/css' media='screen' />
<link rel='stylesheet' id='twentytwelve-fonts-css'  href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700&#038;subset=latin,latin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-style-css'  href='../../../../wp-content/themes/twentytwelve/style.css' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentytwelve-ie-css'  href='http://www.julienlecomte.net/blog/wp-content/themes/twentytwelve/css/ie.css' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='../../../../wp-includes/js/jquery/jquery.js'></script>
<script type='text/javascript' src='../../../../wp-includes/js/jquery/jquery-migrate.min.js'></script>
<script type='text/javascript' src='../../../../wp-content/plugins/jquery-lightbox-for-native-galleries/colorbox/jquery.colorbox-min.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../../xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.3" />
	<link href="../../../../wp-content/plugins/google-code-prettify/prettify.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="../../../../wp-content/plugins/google-code-prettify/prettify.js"></script>
	<!-- jQuery Lightbox For Native Galleries v3.2.2 | http://www.viper007bond.com/wordpress-plugins/jquery-lightbox-for-native-galleries/ -->
<script type="text/javascript">
// <![CDATA[
	jQuery(document).ready(function($){
		$(".gallery").each(function(index, obj){
			var galleryid = Math.floor(Math.random()*10000);
			$(obj).find("a").colorbox({rel:galleryid, maxWidth:"95%", maxHeight:"95%"});
		});
		$("a.lightbox").colorbox({maxWidth:"95%", maxHeight:"95%"});
	});
// ]]>
</script>
</head>

<body class="archive paged category category-web-development category-3 paged-2 category-paged-2 full-width custom-font-enabled single-author">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
		<hgroup>
			<h1 class="site-title"><a href="../../../../../index.html" title="Julien Lecomte&#039;s Blog" rel="home">Julien Lecomte&#039;s Blog</a></h1>
			<h2 class="site-description">Woodworking, Amateur Astronomy, Web Development and Operating System Programming.</h2>
		</hgroup>

		<nav id="site-navigation" class="main-navigation" role="navigation">
			<button class="menu-toggle">Menu</button>
			<a class="assistive-text" href="index.html#content" title="Skip to content">Skip to content</a>
			<div class="nav-menu"><ul><li ><a href="../../../../../index.html">Home</a></li><li class="page_item page-item-36"><a href="../../../../index.html?p=36">About The Author</a></li></ul></div>
		</nav><!-- #site-navigation -->

			</header><!-- #masthead -->

	<div id="main" class="wrapper">
	<section id="primary" class="site-content">
		<div id="content" role="main">

					<header class="archive-header">
				<h1 class="archive-title">Category Archives: <span>Web Development</span></h1>

						</header><!-- .archive-header -->

			
	<article id="post-38" class="post-38 post type-post status-publish format-standard hentry category-web-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="../../../../index.html?p=38" rel="bookmark">The Problem With innerHTML</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>The <code>innerHTML</code> property is extremely popular because it provides a simple way to completely replace the contents of an HTML element. Another way to do that is to use the DOM Level 2 API (<code>removeChild</code>, <code>createElement</code>, <code>appendChild</code>) but using <code>innerHTML</code> is by far the easiest and most efficient way to modify the DOM tree. However, <code>innerHTML</code> has few problems of its own that you need to be aware of:</p>
<ul>
<li>Improper handling of the <code>innerHTML</code> property can enable script-injection attacks on Internet Explorer when the HTML string contains a script tag marked as deffered: <code>&#60;script defer&#62;...&#60;script&#62;</code></li>
<li>Setting <code>innerHTML</code> will destroy existing HTML elements that have event handlers attached to them, potentially creating a memory leak on some browsers.</li>
</ul>
<p>There are a few other minor drawbacks worth mentioning:</p>
<ul>
<li>You don&#8217;t get back a reference to the element(s) you just created, forcing you to add code to retrieve those references manually (using the DOM APIs&hellip;)</li>
<li>You can&#8217;t set the <code>innerHTML</code> property on all HTML elements on all browsers (for instance, Internet Explorer won&#8217;t let you set the <code>innerHTML</code> property of a table row element)</li>
</ul>
<p>I am more concerned with the security and memory issues associated with using the <code>innerHTML</code> property. Obviously, this problem is nothing new, and very bright people have already figured out ways to work around some of these problems.</p>
<p><a href="http://www.crockford.com/" target="_blank">Douglas Crockford</a> wrote a <a href="http://www.crockford.com/javascript/memory/leak.html" target="_blank"><code>purge</code></a> function that takes care of breaking some circular references caused by attaching event handlers to HTML elements, allowing the garbage collector to release all the memory associated with these HTML elements.</p>
<p>Removing the script tags from the HTML string is not as easy as it seems. A regular expression should do the trick, although it&#8217;s hard to know whether it covers all possible cases. Here is the one I came up with:</p>
<pre>
/&#60;script[^&#62;]*&#62;[\S\s]*?&#60;\/script[^&#62;]*&#62;/ig
</pre>
<p>Now, let&#8217;s put these two techniques together in a single <code>setInnerHTML</code> function (<strong>Update:</strong> Thanks to those who commented on this article. I fixed the errors/holes you mentioned, and also decided to bind the <code>setInnerHTML</code> function to <code>YAHOO.util.Dom</code>)</p>
<pre class="prettyprint">
YAHOO.util.Dom.setInnerHTML = function (el, html) {
    el = YAHOO.util.Dom.get(el);
    if (!el || typeof html !== 'string') {
        return null;
    }

    // Break circular references.
    (function (o) {

        var a = o.attributes, i, l, n, c;
        if (a) {
            l = a.length;
            for (i = 0; i < l; i += 1) {
                n = a[i].name;
                if (typeof o[n] === 'function') {
                    o[n] = null;
                }
            }
        }

        a = o.childNodes;

        if (a) {
            l = a.length;
            for (i = 0; i < l; i += 1) {
                c = o.childNodes[i];

                // Purge child nodes.
                arguments.callee(c);

                // Removes all listeners attached to the element via YUI's addListener.
                YAHOO.util.Event.purgeElement(c);
            }
        }

    })(el);

    // Remove scripts from HTML string, and set innerHTML property
    el.innerHTML = html.replace(/&#60;script[^&#62;]*&#62;[\S\s]*?&#60;\/script[^&#62;]*&#62;/ig, "");

    // Return a reference to the first child
    return el.firstChild;
};
</pre>
<p>Voila! Let me know if there is anything else that should be part of this function, or if I missed anything obvious in the regular expression.</p>
<p><strong>Update:</strong> There are obviously many more ways to inject malicious code in a web page. The <code>setInnerHTML</code> function barely normalizes the <code>&#60;script&#62;</code> tag execution behavior across all A-grade browsers. If you are going to inject HTML code that cannot be trusted, make sure you sanitize it first on the server side. There are many libraries available for this.</p>
<p><strong>Update:</strong> IE8 has a new <code>toStaticHTML</code> function attached to the window object that removes any potentially executable content from an HTML string!</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="../../index.html" rel="category tag">Web Development</a> on <a href="../../../../index.html?p=38" title="6:24 pm" rel="bookmark"><time class="entry-date" datetime="2007-12-12T18:24:15+00:00">December 12, 2007</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../../../author/admin/index.html" title="View all posts by Julien Lecomte" rel="author">Julien Lecomte</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-37" class="post-37 post type-post status-publish format-standard hentry category-web-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="../../../../index.html?p=37" rel="bookmark">Adding Back Button and Bookmarking Support to Your DHTML Slide Show</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><a href="http://developer.yahoo.com/yui/" target="_blank">YUI</a> 2.4.0, which was <a href="http://yuiblog.com/blog/2007/12/04/yuii-240/" target="_blank">just released</a> today, comes with a minor update to its history library. To celebrate this new release, I thought I would write a short article demonstrating how to use the YUI Browser History Manager to add back button and bookmarking support to a DHTML slide show.</p>
<p>Let&#8217;s start with a <a href="../../../../../blogfiles/slide-show-bhm/index.html" target="_blank">slightly modified version</a> of Christian Heilmann&#8217;s <a href="http://icant.co.uk/articles/maintainablejavascriptslideshow/" target="_blank">maintainable, unobstrusive DHTML slide show</a>. First, import the YUI Browser History Manager code and its dependencies:</p>
<pre class="prettyprint">
&#60;script type="text/javascript" src="http://yui.yahooapis.com/2.4.0/build/yahoo-dom-event/yahoo-dom-event.js"&#62;&#60;/script&#62;
&#60;script type="text/javascript" src="http://yui.yahooapis.com/2.4.0/build/history/history-min.js"&#62;&#60;/script&#62;
</pre>
<p>Then, add the necessary static markup to the page:</p>
<pre class="prettyprint">
&#60;iframe id="yui-history-iframe" src="img/aston-martin.jpg"&#62;&#60;/iframe&#62;
&#60;input id="yui-history-field" type="hidden"&#62;
</pre>
<p>Note that the asset loaded in the IFrame does not have to be an HTML document (here, we load the first visible image in the slide show) This trick is useful to avoid an additional server round-trip, which would degrade the performance of your site.</p>
<p>Don&#8217;t forget to hide the IFrame by adding the following style declaration:</p>
<pre class="prettyprint">
#yui-history-iframe {
  position:absolute;
  top:0; left:0;
  width:1px; height:1px;
  visibility:hidden;
}
</pre>
<p>Our application is composed of only one module, the slide show, which we will refer to using the identifier &#8220;slideshow&#8221;. The state of the &#8220;slideshow&#8221; module will encode the 0-based index of the currently visible slide. The next step is to figure out the initial state of our slide show module:</p>
<pre class="prettyprint">
initialState = YAHOO.util.History.getBookmarkedState("slideshow") || "0";
</pre>
<p>The &#8220;slideshow&#8221; module can now be registered with the Browser History Manager, passing in the <code>onStateChange</code> callback, which will be executed when the state of the &#8220;slideshow&#8221; module changes:</p>
<pre class="prettyprint">
YAHOO.util.History.register("slideshow", initialState, function (state) {
    showSlide(parseInt(state));
});
</pre>
<p>The initialization routine (<code>initSlideShow</code>) needs to be slightly modified to add a history entry instead of just showing the next slide when the user hits the &#8220;previous&#8221; or &#8220;next&#8221; links:</p>
<pre class="prettyprint">
function initSlideShow () {
    currentSlideIndex = parseInt(YAHOO.util.History.getCurrentState("slideshow"));
    slides = YAHOO.util.Dom.get("slides").getElementsByTagName("li");
    YAHOO.util.Dom.addClass(slides[currentSlideIndex], "current");
    YAHOO.util.Event.addListener(["prev", "next"], "click", function (evt) {
        YAHOO.util.Event.stopEvent(evt);
        var newSlideIndex = this.id === "next" ?
            currentSlideIndex + 1 :
            currentSlideIndex - 1;
        if (newSlideIndex >= slides.length) {
            newSlideIndex = 0;
        } else if (newSlideIndex < 0) {
            newSlideIndex = slides.length - 1;
        }
        YAHOO.util.History.navigate("slideshow", newSlideIndex.toString());
    });
}
</pre>
<p>Call <code>initSlideShow</code> when the Browser History Manager is ready:</p>
<pre class="prettyprint">
YAHOO.util.History.onReady(function () {
    initSlideShow();
});
</pre>
<p>Finally, initialize the Browser History Manager:</p>
<pre class="prettyprint">
YAHOO.util.History.initialize("yui-history-field", "yui-history-iframe");
</pre>
<p>The final version is available <a href="../../../../../blogfiles/slide-show-bhm/index-bhm.html" target="_blank">here</a>. Cheers!</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="../../index.html" rel="category tag">Web Development</a> on <a href="../../../../index.html?p=37" title="10:53 am" rel="bookmark"><time class="entry-date" datetime="2007-12-05T10:53:53+00:00">December 5, 2007</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../../../author/admin/index.html" title="View all posts by Julien Lecomte" rel="author">Julien Lecomte</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-31" class="post-31 post type-post status-publish format-standard hentry category-web-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="../../../../index.html?p=31" rel="bookmark">Introducing CrossFrame, a Safe Communication Mechanism Across Documents and Across Domains</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<h4>The mashup problem</h4>
<p>According to my coworker <cite><a href="http://www.crockford.com" target="_blank">Douglas Crockford</a></cite>, <q lang="en-us">Mashups are the most interesting advancement in software development in decades. They are also unsafe in the current generation of browsers</q>. Lately, Douglas has been spending some time convincing the main browser vendors that mashups need to be made safe, wrote a <a href="http://www.json.org/module.html" target="_blank">proposal</a>, and even <a href="http://ajaxian.com/archives/gears-and-the-mashup-problem" target="_blank">mentioned</a> <a href="http://gears.google.com" target="_blank">Google Gears</a> as a potential solution to the problem. While fixing the browser <em>is</em> the right thing to do, web developers are confronted with this problem <em>today</em>, and cannot afford to wait 5 years for a definitive solution.</p>
<h4>Existing solutions to the mashup problem</h4>
<p>One way mashups (or widgets, badges and gadgets, take your pick&hellip;) can be made safe is by sandboxing them in an IFrame pointing to another domain (Note: another way would be to run the untrusted code through <a href="http://www.adsafe.org/" target="_blank">ADsafe</a>, and provide some safe API to do useful things on the page) The problem is that the <a href="http://en.wikipedia.org/wiki/Same_origin_policy" target="_blank">Same Origin Policy</a> isolates them so completely that they are then unable to cooperate with the page containing them or with each other. Several hacks have been exploited to achieve reasonably secure client-side cross-domain communication. The most popular ones use the <a href="http://tagneto.blogspot.com/2006/06/cross-domain-frame-communication-with.html" target="_blank">URL fragment identifier</a> or the <a href="http://livedocs.adobe.com/flex/2/langref/flash/net/LocalConnection.html" target="_blank">Flash LocalConnection object</a>.</p>
<h4>Why the need for another technique?</h4>
<p>CrossFrame is a variant of the URL fragment identifier mechanism. In the original technique, the containing page sets the URL fragment identifier of an embedded IFrame (usually via its <code>src</code> attribute), and the IFrame must poll to detect changes in the value of its <code>location.hash</code> property. This technique can be further built upon to allow for 2-way communications between an IFrame and its containing page, or between two distinct IFrames.</p>
<p>The original URL fragment identifier technique has many limitations, many of which can be worked around except maybe for the following:</p>
<ul>
<li>It unnecessarily consumes CPU cycles by requiring the receiver to poll.</li>
<li>It creates &#8220;fake&#8221; history entries on Safari and Opera.</li>
</ul>
<h4>How does CrossFrame work?</h4>
<p>While CrossFrame also has limitations of its own, I find it to be a much cleaner and simpler approach. Here is how it works:</p>
<p><img src="../../../../../blogfiles/cross-frame/diagram.png" width="398" height="316" style="border:0;padding:0;margin:10px 0;"></p>
<p>In order to communicate with the mashup hosted in domain Y, the page, hosted in domain X, dynamically creates a hidden IFrame and points it to a special proxy file hosted in domain Y, using the URL fragment identifier to convey the message (step 1) When the special proxy file is loaded in the hidden IFrame, it reads its URL fragment identifier and passes it to a globally accessible function defined in the IFrame hosting the mashup (step 2) using <code>parent.frames['mashup']</code> to get to it. The same technique can also be used by the mashup to communicate with the page (the proxy will use <code>parent.parent</code> to get to the page) Finally, when all is said and done, the hidden IFrame is automatically removed from the DOM by the library.</p>
<p>This however cannot work on Opera, which does not allow us to query any property of a window pointing to a different domain (so getting <code>parent.parent</code> for example will throw an exception) CrossFrame takes care of this by using, on Opera only, <a href="http://www.whatwg.org/specs/web-apps/current-work/#cross-document" target="_blank">the HTML 5 way</a> of sending messages across frames and across domains.</p>
<h4>How to use CrossFrame?</h4>
<p>In order to use the CrossFrame library, place the proxy file (proxy.html, included in the <a href="../../../../../blogfiles/cross-frame/cross-frame.zip">downloadable archive</a>) on your web server so you can receive CrossFrame notifications for that domain. Make sure that the proxy file gets cached properly by web browsers, for example using a <code>.htacess</code> file similar to this one:</p>
<pre>
&#60;Files proxy.html&#62;
    ExpiresActive on
    ExpiresDefault "access plus 1 year"
&#60;/Files&#62;
</pre>
<p>Then, import the necessary code and its dependencies in your page:</p>
<pre class="prettyprint" style="overflow:auto;">
&#60;script type="text/javascript" src="http://yui.yahooapis.com/2.3.1/build/yahoo-dom-event/yahoo-dom-event.js"&#62;&#60;/script&#62;
&#60;script type="text/javascript" src="cross-frame.js"&#62;&#60;/script&#62;
</pre>
<p>To receive messages, subscribe to the <code>onMessage</code> event:</p>
<pre class="prettyprint">
YAHOO.util.CrossFrame.onMessageEvent.subscribe(
    function (type, args, obj) {
        var message = args[0];
        var domain = args[1];
        // Do something with the incoming message...
    }
);
</pre>
<p>To send a message, call <code>YAHOO.util.CrossFrame.send()</code>:</p>
<pre class="prettyprint">
YAHOO.util.CrossFrame.send("http://www.y.com/proxy.html",
                           "frames['mashup']",
                           "message");
</pre>
<p>Here is a <a href="../../../../../blogfiles/cross-frame/index.html" target="_blank">demo</a> showing the CrossFrame library in action.</p>
<h4>Limitations</h4>
<p>The CrossFrame library does not support chunking (i.e. the ability to pass a large message in several smaller chunks) so the size of the messages that may be sent is limited by the maximum length of a URL (which varies across browsers&hellip;) However, it is not impossible to implement (for more information on chunking, you may want to look at Dojo&#8217;s XHR IFrame proxy implementation, which I believe supports chunking)</p>
<p>Also, the user may experience a short delay the first time a message gets sent to a specific domain. This is due to the server round trip necessary to download the proxy file. However, this can easily be mitigated by preloading the proxy file for that specific domain.</p>
<h4>Conclusion: The dangers of temporary solutions</h4>
<p>There is a danger associated with this kind of &#8220;hack&#8221;. First of all, browser vendors may decide to change their security policies and mimic Opera&#8217;s behavior for example. If this happens, CrossFrame will stop working for those browsers. Furthermore, I do not recommend using hacks because they slow down the rate of innovation on the web (it makes the task of developing web browsers even more complicated than it already is, and also makes your application less maintainable) Therefore, as paradoxical as it may seem, I do <em>not</em> recommend using CrossFrame (or any of those ugly hacks for that matter)</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="../../index.html" rel="category tag">Web Development</a> on <a href="../../../../index.html?p=31" title="3:36 pm" rel="bookmark"><time class="entry-date" datetime="2007-11-26T15:36:12+00:00">November 26, 2007</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../../../author/admin/index.html" title="View all posts by Julien Lecomte" rel="author">Julien Lecomte</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-30" class="post-30 post type-post status-publish format-standard hentry category-web-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="../../../../index.html?p=30" rel="bookmark">Getting Rid of the Navigation Click Sound on IE</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>Internet Explorer plays a little click sound when the location of a page changes. This is a great usability feature as it lets the user know that something is happening. However, this little click sound can become really annoying with web applications that make extensive use of <code>iframe</code>s. For example, imagine an application using several <code>iframe</code>s to sandbox untrusted third party ads. Refreshing the content of the <code>iframe</code>s (by changing their <code>src</code> attribute) makes the application sound like an automatic rifle. Scary, huh? Well, I recently found out about a very clever trick that can make this click sound go away.</p>
<p>Replace:</p>
<pre class="prettyprint">
iframe.src = "...";
</pre>
<p>by:</p>
<pre class="prettyprint">
var newIFrame = document.createElement("iframe");
newIFrame.src = "...";
iframe.parentNode.replaceChild(newIframe, iframe);
</pre>
<p>The secret is to set the <code>iframe</code> <code>src</code> attribute before appending it to the document&#8230; However, this simple approach exhibits a very unpleasant flickering. The following snippet shows how to get rid of the flickering as well:</p>
<pre class="prettyprint" style="overflow-x: auto; overflow-y: hidden;">
function setIFrameSrc(iframe, src) {
    var el;
    iframe = YAHOO.util.Dom.get(iframe);
    if (YAHOO.env.ua.ie) {
        // Create a new hidden iframe.
        el = iframe.cloneNode(true);
        el.style.position = "absolute";
        el.style.visibility = "hidden";
        // keep the original iframe id unique!
        el.id = "";
        // Listen for the onload event.
        YAHOO.util.Event.addListener(el, "load", function () {
            // First, remove the event listener or the old iframe
            // we intend to discard will not be freed...
            YAHOO.util.Event.removeListener(this, "load", arguments.callee);
            // Show the iframe.
            this.style.position = "";
            this.style.visibility = "";
            // Replace the old iframe with the new one.
            iframe.parentNode.replaceChild(this, iframe);
            // Reset the iframe id.
            this.id = iframe.id;
        });
        // Set its src first...
        el.src = src;
        // ...and then append it to the body of the document.
        document.body.appendChild(el);
    } else {
        iframe.src = src;
    }
}
</pre>
<p>This <a href="../../../../../blogfiles/javascript/iframe-click-noise.html" target="_blank">example</a> demonstrates this technique (turn the volume up, and open it up with Internet Explorer) Note: the navigation sound you hear when using Internet Explorer (or Windows Explorer) can be configured via the Sounds dialog accessible from the Control Panel.</p>
<p><strong>Update:</strong> I forgot to mention that, by using this trick, you will break the back / forward navigation buttons. Therefore, this trick should only be used for a non-navigational purpose only.</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="../../index.html" rel="category tag">Web Development</a> on <a href="../../../../index.html?p=30" title="12:45 pm" rel="bookmark"><time class="entry-date" datetime="2007-11-11T12:45:55+00:00">November 11, 2007</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../../../author/admin/index.html" title="View all posts by Julien Lecomte" rel="author">Julien Lecomte</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-28" class="post-28 post type-post status-publish format-standard hentry category-web-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="../../../../index.html?p=28" rel="bookmark">Running CPU Intensive JavaScript Computations in a Web Browser</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><em>The pattern discussed below is a well known pattern that has been used for 10 years. The goal of this article is to present this pattern under a new light, and most importantly to discuss ways of reducing its overhead.</em></p>
<p>The biggest deterrent for running CPU intensive computations in a web browser is the fact that the entire browser user interface is frozen while a JavaScript thread is running. This means that under no circumstance should a script ever take more than 300 msec (at most) to complete. Breaking this rule inevitably leads to bad user experience.</p>
<p>Furthermore, in web browsers, JavaScript threads have a limited amount of time to complete (there can be either a static time limit &#8212; that&#8217;s the case of Mozilla based browsers &#8212; or some other limit such as a maximum number of elementary operations &#8212; that&#8217;s the case of Internet Explorer) If a script takes too long to complete, the user is presented with a dialog asking whether that script should be terminated.</p>
<p><a href="http://gears.google.com" target="_blank">Google Gears</a> provides the ability to run CPU intensive JavaScript code without the two aforementioned limitations. However, you cannot usually rely on the presence of Gears (in the future, I would like to see a solution like the Gears WorkerPool API as part of the standard browser API)</p>
<p>Fortunately, the <code>setTimeout</code> method of the global object allows us to execute code on a delay, giving the browser a chance to handle events and update the user interface, even if the timeout value passed to <code>setTimeout</code> is 0. This allows us to cut a long running process into smaller units of work, and chain them according to the following pattern:</p>
<pre class="prettyprint">
function doSomething (callbackFn [, additional arguments]) {
    // Initialize a few things here...
    (function () {
        // Do a little bit of work here...
        if (<em>termination condition</em>) {
            // We are done
            callbackFn();
        } else {
            // Process next chunk
            setTimeout(arguments.callee, 0);
        }
    })();
}
</pre>
<p>This pattern can also be slightly modified to accept a progress callback instead of a completion callback. This is especially useful when using a progress bar:</p>
<pre class="prettyprint">
function doSomething (progressFn [, additional arguments]) {
    // Initialize a few things here...
    (function () {
        // Do a little bit of work here...
        if (<em>continuation condition</em>) {
            // Inform the application of the progress
            progressFn(<em>value</em>, <em>total</em>);
            // Process next chunk
            setTimeout(arguments.callee, 0);
        }
    })();
}
</pre>
<p>This <a href="../../../../../blogfiles/javascript/long-running-js-process.html" target="_blank">example</a> demonstrates the sorting of a fairly large array using this pattern.</p>
<p><strong>Notes:</strong></p>
<ol>
<li>This pattern has a lot of overhead i.e. the total amount of time required to complete a task can be far greater than the time it would take to run the same task uninterrupted.</li>
<li>The shorter each cycle, the greater the overhead, the more reactive the user interface, the greater the overall time required to complete the task.</li>
<li>If you can be sure that each iteration of your algorithm is of very short duration &#8212; say 10 msec, you may want to group several iterations within a single cycle to reduce the overhead. The decision whether to start the next cycle or continue with more iterations can be made based on how long the current cycle has been running. This <a href="../../../../../blogfiles/javascript/long-running-js-process-optimized.html" target="_blank">example</a> demonstrates this technique. Although it uses the same sorting algorithm as the example above, notice how much faster it is, while still keeping the user interface perfectly reactive.</li>
<li><em>Never</em> pass a string to <code>setTimeout</code>! If you do, the browser needs to do an implicit <code>eval</code> <em>every time</em> the code is executed, which adds an incredible amount of completely unnecessary overhead.</li>
<li>If you manipulate global data, make sure that access to that data is synchronized since it could also be modified by another JavaScript thread running between two cycles of your task.</li>
</ol>
<p>Finally, consider running this kind of task on the server (though you&#8217;ll have to deal with serialization / deserialization and network latency, especially if the data set is large) Having to run CPU intensive computations on the client <em>might</em> be a sign of a deeper, more serious architectural problem with your application.</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="../../index.html" rel="category tag">Web Development</a> on <a href="../../../../index.html?p=28" title="1:51 pm" rel="bookmark"><time class="entry-date" datetime="2007-10-25T13:51:05+00:00">October 25, 2007</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../../../author/admin/index.html" title="View all posts by Julien Lecomte" rel="author">Julien Lecomte</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-26" class="post-26 post type-post status-publish format-standard hentry category-web-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="../../../../index.html?p=26" rel="bookmark">The Birth Of Web 3.0</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>Is Web 3.0 yet another buzz word, or is it a real turnaround in our industry?</p>
<p>Web 1.0 was the good old web of the 1990s. In those times, all client-side changes were the result of a server round-trip. The Internet was ramping up in popularity.</p>
<p>Web 2.0 has been a little more than just a technological evolution. The staple of Web 2.0 has been the emergence of social media (Internet users creating most of the content), powered by mature technologies (DHTML, Ajax) on somewhat stable web browsers.</p>
<p>Web 3.0 is not a revolution either. It is yet another technological evolution destined to provide users with an even better experience, both online and offline. Web 3.0 will lead to the blurring of that artificial wall between the web browser and the desktop, providing a full &#8212; but secure &#8212; integration with devices and services exposed by the operating system.</p>
<p>Web 3.0 is just starting. Look around you and you&#8217;ll see that Web 3.0 technologies are slowly cropping up everywhere on the web. <a href="http://gears.google.com/" target="_blank">Google Gears</a>, one of the first Web 3.0 technologies, allows you to build web applications that can work offline. Thanks to Google Gears, applications such as <a href="http://www.rememberthemilk.com/" target="_blank">Remember The Milk</a>, an online to-do list and task management system, can now work offline. <a href="http://www.adobe.com/products/flashplayer/" target="_blank">The Adobe Flash player</a> already allows application developers limited access to the webcam and the microphone. Soon, we&#8217;ll also be able to drag and drop files from the desktop to a web browser (see this <a href="http://www.javaatwork.com/" target="_blank">Java Upload Applet</a> for an example using the <a href="http://java.sun.com/" target="_blank">Java technology</a>)</p>
<p>Another aspect of Web 3.0 is the use of stunning graphics, smooth animations, high definition audio and video, 3D, etc. and all of this inside a web browser!</p>
<p>At first, Web 3.0 features will be available using plugins (<a href="http://gears.google.com/" target="_blank">Google Gears</a>, <a href="http://java.sun.com/" target="_blank">Java</a>, <a href="http://www.adobe.com/products/flashplayer/" target="_blank">Flash</a>, <a href="http://silverlight.net/" target="_blank">Silverlight</a>, ActiveX and Firefox extensions, etc.) But slowly, we may start seeing browser vendors integrating them into their browsers, followed by some level of standardization. The <a href="http://www.whatwg.org/specs/web-apps/current-work/" target="_blank">HTML 5 Working Draft</a> seems to be going in the right direction.</p>
<p>These are exciting times for web front-end engineers! The risk of fragmentation, inevitable with such ground-breaking technologies, will hopefully be mitigated in the short term by the use of JavaScript toolkits. The <a href="http://dojotoolkit.org/" target="_blank">Dojo Toolkit</a>, for example, has already started making Web 3.0 features available (see dojo.gfx and the <a href="http://dojotoolkit.org/offline" target="_blank">Dojo Offline Toolkit</a>) Hopefully, all the other major frameworks will follow suite so we can all start building cool new applications that wow our users!</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="../../index.html" rel="category tag">Web Development</a> on <a href="../../../../index.html?p=26" title="9:09 am" rel="bookmark"><time class="entry-date" datetime="2007-10-06T09:09:13+00:00">October 6, 2007</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../../../author/admin/index.html" title="View all posts by Julien Lecomte" rel="author">Julien Lecomte</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-25" class="post-25 post type-post status-publish format-standard hentry category-web-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="../../../../index.html?p=25" rel="bookmark">Adobe MAX 2007</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>I am currently attending the <a href="http://www.adobemax2007.com/" target="_blank">Adobe MAX 2007</a> conference in Chicago, IL. Yesterday&#8217;s keynote was a great showcase of what Adobe&#8217;s latest technologies are about to bring to the web and to the desktop. Here are a few pictures of the keynote (hover over the images to get a short description)</p>
<p><a href="../../../../../blogfiles/adobe-max-2007/photos/kevin-lynch-keynote.jpg" style="float:left;margin-right:10px;" target="_blank"><img src="../../../../../blogfiles/adobe-max-2007/thumbs/kevin-lynch-keynote.jpg" width="120" height="90" alt="Kevin Lynch's keynote" title="Kevin Lynch's keynote"></a></p>
<p><a href="../../../../../blogfiles/adobe-max-2007/photos/google-analytics-on-air.jpg" style="float:left;margin-right:10px;" target="_blank"><img src="../../../../../blogfiles/adobe-max-2007/thumbs/google-analytics-on-air.jpg" width="120" height="90" alt="An AIR application running Google Analytics" title="An AIR application running Google Analytics"></a></p>
<p><a href="../../../../../blogfiles/adobe-max-2007/photos/air-derby-results.jpg" style="float:left;margin-right:10px;" target="_blank"><img src="../../../../../blogfiles/adobe-max-2007/thumbs/air-derby-results.jpg" width="120" height="90" alt="The winners of the AIR challenge" title="The winners of the AIR challenge"></a></p>
<p><br style="clear:both;line-height:0;"/></p>
<p><a href="../../../../../blogfiles/adobe-max-2007/photos/adobe-developer-connection.jpg" style="float:left;margin-right:10px;" target="_blank"><img src="../../../../../blogfiles/adobe-max-2007/thumbs/adobe-developer-connection.jpg" width="120" height="90" alt="Adobe Developer Connection announcement" title="Adobe Developer Connection announcement"></a></p>
<p><a href="../../../../../blogfiles/adobe-max-2007/photos/heidi-williams-flex-3.jpg" style="float:left;margin-right:10px;" target="_blank"><img src="../../../../../blogfiles/adobe-max-2007/thumbs/heidi-williams-flex-3.jpg" width="120" height="90" alt="Heidi Williams talking about the new features in Flex 3" title="Heidi Williams talking about the new features in Flex 3"></a></p>
<p><a href="../../../../../blogfiles/adobe-max-2007/photos/flash-player-10.jpg" style="float:left;margin-right:10px;" target="_blank"><img src="../../../../../blogfiles/adobe-max-2007/thumbs/flash-player-10.jpg" width="120" height="90" alt="The Flash Player team talking about the new features in Flash Player 10" title="The Flash Player team talking about the new features in Flash Player 10"></a></p>
<p><br style="clear:both;line-height:0;"/></p>
<p>I have been involved with web development since 2001, and Ajax since 2003 (before it was even coined &#8220;Ajax&#8221;) I have looked at Adobe&#8217;s technologies for a while, and have finally come around. I have to admit that Flash Player 9, ActionScript 3, Flex 2 (Flex 3 coming very soon) and Flex Builder 2 (soon Flex Builder 3) make for a very solid development platform to create rich Internet applications. Add AIR (Adobe&#8217;s Integrated Runtime) to the mix and you have a great platform to develop cross-platform, web-enabled applications.</p>
<p>My only problem with Adobe&#8217;s technologies is that they are proprietary technologies. However, this only outlines the failure of the W3C and other standards bodies to push the web forward. And with an incredible 90% market penetration (according to Adobe), isn&#8217;t Flash a <em>De Facto</em> standard anyway?</p>
<p><strong>Update: </strong> After attending the day 2 keynote, I keep thinking that while so many web developers are still trying to figure out how to make rounded corners work on all browsers, Adobe is really pushing the envelope with truly ground-breaking technologies. What a contrast!</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="../../index.html" rel="category tag">Web Development</a> on <a href="../../../../index.html?p=25" title="6:34 am" rel="bookmark"><time class="entry-date" datetime="2007-10-02T06:34:45+00:00">October 2, 2007</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../../../author/admin/index.html" title="View all posts by Julien Lecomte" rel="author">Julien Lecomte</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-24" class="post-24 post type-post status-publish format-standard hentry category-web-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="../../../../index.html?p=24" rel="bookmark">YUI Compressor Version 2.2.1 Now Available</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>I implemented a few enhancement requests and fixed a bug in this new version of the YUI Compressor. Let me know if you encounter any issue with it.</p>
<p><strong>Update (9/27/07): </strong> YUI Compressor version 2.2.2 is now available. It fixes a lot of bugs that have been reported recently. By the way, I really appreciate all the bug reports, so keep them coming!</p>
<p><strong>Update (9/28/07): </strong> New bugs have been reported and fixed in version 2.2.3 now available for download (check out the CHANGELOG file in the download page) And keep these bug reports coming!</p>
<p><strong>Update (10/1/07): </strong> A few more minor bugs have been fixed in version 2.2.4. Thanks for the bug reports!</p>
<p style="margin:30px 0;text-align:center;"><a href="http://www.julienlecomte.net/yuicompressor/" target="_blank" style="padding:8px;border:1px solid #bbb;font-weight:bold;text-decoration:underline;">Download version 2.2.4 of the YUI Compressor</a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="../../index.html" rel="category tag">Web Development</a> on <a href="../../../../index.html?p=24" title="11:56 am" rel="bookmark"><time class="entry-date" datetime="2007-09-28T11:56:29+00:00">September 28, 2007</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../../../author/admin/index.html" title="View all posts by Julien Lecomte" rel="author">Julien Lecomte</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-23" class="post-23 post type-post status-publish format-standard hentry category-web-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="../../../../index.html?p=23" rel="bookmark">Trimming comments in HTML documents using Apache Ant</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>This short article, explaining how to trim unnecessary code (comments, empty lines) from HTML documents, is a follow-up to an article published a couple of weeks ago on this blog: <a href="../../../../2007/09/11/building-web-applications-with-apache-ant/index.html" target="_blank"> Building Web Applications With Apache Ant</a>. Basically, the idea is to use Ant&#8217;s optional <code>replaceregexp</code> task as shown below:</p>
<pre class="prettyprint" style="overflow-x: auto; overflow-y: hidden;">
&#60;target name="-trim.html.comments"&#62;

    &#60;fileset id="html.fileset"
        dir="${build.dir}"
        includes="**/*.jsp, **/*.php, **/*.html"/&#62;

    &#60;!-- HTML Comments --&#62;
    &#60;replaceregexp replace="" flags="g"
        match="\&amp;lt;![ \r\n\t]*(--([^\-]|[\r\n]|-[^\-])*--[ \r\n\t]*)\&amp;gt;"&#62;
        &#60;fileset refid="html.fileset"/&#62;
    &#60;/replaceregexp&#62;

    &#60;!-- Empty lines --&#62;
    &#60;replaceregexp match="^\s+[\r\n]" replace="" flags="mg"&#62;
        &#60;fileset refid="html.fileset"/&#62;
    &#60;/replaceregexp&#62;

&#60;/target&#62;
</pre>
<p><strong>Update:</strong> Use this code very carefully as it is dangerous territory (Thanks to my co-worker <a href="http://wonko.com/" target="_blank">Ryan Grove</a> for pointing out some of the shortcomings)</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="../../index.html" rel="category tag">Web Development</a> on <a href="../../../../index.html?p=23" title="2:45 pm" rel="bookmark"><time class="entry-date" datetime="2007-09-20T14:45:58+00:00">September 20, 2007</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../../../author/admin/index.html" title="View all posts by Julien Lecomte" rel="author">Julien Lecomte</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

	<article id="post-22" class="post-22 post type-post status-publish format-standard hentry category-web-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="../../../../index.html?p=22" rel="bookmark">YUI Compressor Version 2.2 Now Available</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>This new version of the YUI Compressor supports <code>stdin</code> and <code>stdout</code>. This means that you can now call the YUI Compressor using the following command line:</p>
<pre>
java -jar yuicompressor-2.2.jar --type js < input.js > output.js
</pre>
<p>You can still use the following syntax as well:</p>
<pre>
java -jar yuicompressor-2.2.jar -o output.js input.js
</pre>
<p>This has three main consequences:</p>
<ol>
<li>All informational and error messages are now printed to <code>stderr</code>.</li>
<li>If no input file is specified, the YUI Compressor defaults to <code>stdin</code>. In that case, you <em>must</em> specify the <code>--type</code> option because the YUI compressor has no way of knowing whether it should invoke the JavaScript or CSS compressor (there is no file extension to look at)</li>
<li>If no output file is specified, the YUI Compressor defaults to <code>stdout</code> (in prior versions, it used to create a file named after the input file, and appended the <code>-min</code> suffix)</li>
</ol>
<p>The other main feature brought by this new version of the YUI Compressor is the support for <a href="http://www.javascriptkit.com/javatutors/conditionalcompile.shtml" target="_blank">JScript conditional comments</a>:</p>
<pre class="prettyprint">
/*@cc_on
   /*@if (@_win32)
      document.write("OS is 32-bit, browser is IE.");
   @else @*/
      document.write("Browser is not 32 bit IE.");
   /*@end
@*/
</pre>
<p>Note that the presence of a conditional comment inside a function (i.e. not in the global scope) will reduce the level of compression for the same reason  the use of <code>eval</code> or <code>with</code> reduces the level of compression (conditional comments, which do not get parsed, may refer to local variables, which get obfuscated) In any case, the use of Internet Explorer&#8217;s conditional comments is to be avoided.</p>
<p>Finally, a few improvements have been made to the CSS compressor.</p>
<p style="margin:30px 0;text-align:center;"><a href="http://www.julienlecomte.net/yuicompressor/" target="_blank" style="padding:8px;border:1px solid #bbb;font-weight:bold;text-decoration:underline;">Download version 2.2 of the YUI Compressor</a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="../../index.html" rel="category tag">Web Development</a> on <a href="../../../../index.html?p=22" title="4:15 pm" rel="bookmark"><time class="entry-date" datetime="2007-09-18T16:15:46+00:00">September 18, 2007</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../../../author/admin/index.html" title="View all posts by Julien Lecomte" rel="author">Julien Lecomte</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
		<nav id="nav-below" class="navigation" role="navigation">
			<h3 class="assistive-text">Post navigation</h3>
			<div class="nav-previous"><a href="../3/index.html" ><span class="meta-nav">&larr;</span> Older posts</a></div>
			<div class="nav-next"><a href="../../index.html" >Newer posts <span class="meta-nav">&rarr;</span></a></div>
		</nav><!-- #nav-below .navigation -->
	
		
		</div><!-- #content -->
	</section><!-- #primary -->


		<script type="text/javascript">
		window.onload = function(){prettyPrint();};
	</script>
	</div><!-- #main .wrapper -->
	<footer id="colophon" role="contentinfo">
		<div class="site-info">
						<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform">Proudly powered by WordPress</a>
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type="text/javascript">
// <![CDATA[
// ]]>
</script>
<script type='text/javascript' src='../../../../wp-content/themes/twentytwelve/js/navigation.js'></script>
</body>
</html>
