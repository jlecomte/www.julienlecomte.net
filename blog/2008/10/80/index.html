<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) & !(IE 8)]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>YUI Compressor and Java Class Loader | Julien Lecomte&#039;s Blog</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="http://www.julienlecomte.net/blog/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="http://www.julienlecomte.net/blog/wp-content/themes/twentytwelve/js/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel="alternate" type="application/rss+xml" title="Julien Lecomte&#039;s Blog &raquo; Feed" href="../../../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Julien Lecomte&#039;s Blog &raquo; Comments Feed" href="../../../comments/feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Julien Lecomte&#039;s Blog &raquo; YUI Compressor and Java Class Loader Comments Feed" href="feed/index.html" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"http:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/www.julienlecomte.net\/blog\/wp-includes\/js\/wp-emoji-release.min.js"}};
			!function(a,b,c){function d(a){var c=b.createElement("canvas"),d=c.getContext&&c.getContext("2d");return d&&d.fillText?(d.textBaseline="top",d.font="600 32px Arial","flag"===a?(d.fillText(String.fromCharCode(55356,56812,55356,56807),0,0),c.toDataURL().length>3e3):(d.fillText(String.fromCharCode(55357,56835),0,0),0!==d.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='colorbox-theme1-css'  href='../../../wp-content/plugins/jquery-lightbox-for-native-galleries/colorbox/theme1/colorbox.css' type='text/css' media='screen' />
<link rel='stylesheet' id='twentytwelve-fonts-css'  href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700&#038;subset=latin,latin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-style-css'  href='../../../wp-content/themes/twentytwelve/style.css' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentytwelve-ie-css'  href='http://www.julienlecomte.net/blog/wp-content/themes/twentytwelve/css/ie.css' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='../../../wp-includes/js/jquery/jquery.js'></script>
<script type='text/javascript' src='../../../wp-includes/js/jquery/jquery-migrate.min.js'></script>
<script type='text/javascript' src='../../../wp-content/plugins/jquery-lightbox-for-native-galleries/colorbox/jquery.colorbox-min.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='The Modern Moon: A Personal View' href='../../../index.html?p=66' />
<link rel='next' title='Stop Using GMT!' href='../../../index.html?p=115' />
<meta name="generator" content="WordPress 4.3" />
<link rel='canonical' href='../../../index.html?p=80' />
<link rel='shortlink' href='../../../index.html?p=80' />
	<link href="../../../wp-content/plugins/google-code-prettify/prettify.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="../../../wp-content/plugins/google-code-prettify/prettify.js"></script>
	<!-- jQuery Lightbox For Native Galleries v3.2.2 | http://www.viper007bond.com/wordpress-plugins/jquery-lightbox-for-native-galleries/ -->
<script type="text/javascript">
// <![CDATA[
	jQuery(document).ready(function($){
		$(".gallery").each(function(index, obj){
			var galleryid = Math.floor(Math.random()*10000);
			$(obj).find("a").colorbox({rel:galleryid, maxWidth:"95%", maxHeight:"95%"});
		});
		$("a.lightbox").colorbox({maxWidth:"95%", maxHeight:"95%"});
	});
// ]]>
</script>
</head>

<body class="single single-post postid-80 single-format-standard full-width custom-font-enabled single-author">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
		<hgroup>
			<h1 class="site-title"><a href="../../../../index.html" title="Julien Lecomte&#039;s Blog" rel="home">Julien Lecomte&#039;s Blog</a></h1>
			<h2 class="site-description">Woodworking, Amateur Astronomy, Web Development and Operating System Programming.</h2>
		</hgroup>

		<nav id="site-navigation" class="main-navigation" role="navigation">
			<button class="menu-toggle">Menu</button>
			<a class="assistive-text" href="../../../index.html?p=80#content" title="Skip to content">Skip to content</a>
			<div class="nav-menu"><ul><li ><a href="../../../../index.html">Home</a></li><li class="page_item page-item-36"><a href="../../../index.html?p=36">About The Author</a></li></ul></div>
		</nav><!-- #site-navigation -->

			</header><!-- #masthead -->

	<div id="main" class="wrapper">
	<div id="primary" class="site-content">
		<div id="content" role="main">

			
				
	<article id="post-80" class="post-80 post type-post status-publish format-standard hentry category-web-development">
				<header class="entry-header">
			
						<h1 class="entry-title">YUI Compressor and Java Class Loader</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>The <a href="../../../index.html?p=11">YUI Compressor</a> uses a slightly modified version of the parser used in the <a href="http://www.mozilla.org/rhino/">Rhino</a> JavaScript engine. The reason for modifying the parser came from the need to support JScript conditional comments, unescaped forward slashes in regular expressions &#8212; which all browsers support and many people use &#8212; and a few micro optimizations. The problem is that many users had the original Rhino Jar file somewhere on their system, either in their classpath, or in their JRE extension directory (&lt;JRE_HOME&gt;/lib/ext) This caused many headaches because the wrong classes were being loaded, leading to many weird bugs.</p>
<p>Today, I finally decided to do something about it. This meant writing a custom class loader to load the modified classes directly from the YUI Compressor Jar file. You can download the source and binary package here:</p>
<p style="margin:30px 0;text-align:center;"><a href="http://www.julienlecomte.net/yuicompressor/" target="_blank" style="padding:8px;border:1px solid #bbb;font-weight:bold;text-decoration:underline;">Download version 2.4 of the YUI Compressor</a></p>
<p>The skeleton of the custom class loader is pretty straightforward:</p>
<pre class="prettyprint">
package com.yahoo.platform.yui.compressor;

public class JarClassLoader extends ClassLoader
{
    public Class loadClass(String name) throws ClassNotFoundException
    {
        // First check if the class is already loaded
        Class c = findLoadedClass(name);
        if (c == null) {
            // Try to load the class ourselves
            c = findClass(name);
        }

        if (c == null) {
            // Fall back to the system class loader
            c = ClassLoader.getSystemClassLoader().loadClass(name);
        }

        return c;
    }

    protected Class findClass(String name)
    {
        // Most of the heavy lifting takes place here
    }
}
</pre>
<p>The role of the <code>findClass</code> method is to first locate the YUI Compressor Jar file. To do that, we look in the classpath for a Jar file that contains the <code>com.yahoo.platform.yui.compressor.JarClassLoader</code> class:</p>
<pre class="prettyprint">
private static String jarPath;

private static String getJarPath()
{
    if (jarPath != null) {
        return jarPath;
    }

    String classname = JarClassLoader.class.getName().replace('.', '/') + ".class";
    String classpath = System.getProperty("java.class.path");
    String classpaths[] = classpath.split(System.getProperty("path.separator"));
    for (int i = 0; i < classpaths.length; i++) {
        String path = classpaths[i];
        JarFile jarFile = new JarFile(path);
        JarEntry jarEntry = findJarEntry(jarFile, classname);
        if (jarEntry != null) {
            jarPath = path;
            break;
        }
    }

    return jarPath;
}

private static JarEntry findJarEntry(JarFile jarFile, String entryName)
{
    Enumeration entries = jarFile.entries();
    while (entries.hasMoreElements()) {
        JarEntry entry = (JarEntry) entries.nextElement();
        if (entry.getName().equals(entryName)) {
            return entry;
        }
    }
    return null;
}
</pre>
<p>Once we know where the YUI Compressor Jar file is, we can load the appropriate class from that file. Note the need to define the package the class belongs to before calling <code>defineClass</code>!</p>
<pre class="prettyprint">
protected Class findClass(String name)
{
    Class c = null;
    String jarPath = getJarPath();
    if (jarPath != null) {
        JarFile jarFile = new JarFile(jarPath);
        c = loadClassData(jarFile, name);
    }
    return c;
}

private Class loadClassData(JarFile jarFile, String className)
{
    String entryName = className.replace('.', '/') + ".class";
    JarEntry jarEntry = findJarEntry(jarFile, entryName);
    if (jarEntry == null) {
        return null;
    }

    // Create the necessary package if needed...
    int index = className.lastIndexOf('.');
    if (index >= 0) {
        String packageName = className.substring(0, index);
        if (getPackage(packageName) == null) {
            definePackage(packageName, "", "", "", "", "", "", null);
        }
    }

    // Read the Jar File entry and define the class...
    InputStream is = jarFile.getInputStream(jarEntry);
    ByteArrayOutputStream os = new ByteArrayOutputStream();
    copy(is, os);
    byte[] bytes = os.toByteArray();
    return defineClass(className, bytes, 0, bytes.length);
}

private void copy(InputStream in, OutputStream out)
{
    byte[] buf = new byte[1024];
    while (true) {
        int len = in.read(buf);
        if (len < 0) break;
        out.write(buf, 0, len);
    }
}
</pre>
<p>The last thing we need to do is bootstrap the application. In order to do that, we simply load the main class (<code>YUICompressor</code>) using our new custom class loader. All the classes that will be needed at runtime will use the same class loader:</p>
<pre class="prettyprint">
package com.yahoo.platform.yui.compressor;

public class Bootstrap
{
    public static void main(String args[]) throws Exception
    {
        ClassLoader loader = new JarClassLoader();
        Thread.currentThread().setContextClassLoader(loader);
        Class c = loader.loadClass(YUICompressor.class.getName());
        Method main = c.getMethod("main", new Class[]{String[].class});
        main.invoke(null, new Object[]{args});
    }
}
</pre>
<p>As you can see, it's not terribly complicated to write a custom class loader. Note: I left out all the exception handling code and the import statements for clarity. The final code can be found in the downloadable archive. Cheers!</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="../../../category/web-development/index.html" rel="category tag">Web Development</a> on <a href="../../../2008/10/80/index.html" title="5:16 pm" rel="bookmark"><time class="entry-date" datetime="2008-10-21T17:16:32+00:00">October 21, 2008</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../../author/admin/index.html" title="View all posts by Julien Lecomte" rel="author">Julien Lecomte</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

				<nav class="nav-single">
					<h3 class="assistive-text">Post navigation</h3>
					<span class="nav-previous"><a href="../../../2008/10/66/index.html" rel="prev"><span class="meta-nav">&larr;</span> The Modern Moon: A Personal View</a></span>
					<span class="nav-next"><a href="../../../2008/10/115/index.html" rel="next">Stop Using GMT! <span class="meta-nav">&rarr;</span></a></span>
				</nav><!-- .nav-single -->

				
<div id="comments" class="comments-area">

	
			<h2 class="comments-title">
			14 thoughts on &ldquo;<span>YUI Compressor and Java Class Loader</span>&rdquo;		</h2>

		<ol class="commentlist">
				<li class="comment even thread-even depth-1" id="li-comment-3095">
		<article id="comment-3095" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://2.gravatar.com/avatar/814b04d59db45d04cd9c2bb2ad3ca4f6?s=44&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/814b04d59db45d04cd9c2bb2ad3ca4f6?s=88&amp;d=mm&amp;r=g 2x' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">JY</b> </cite><a href="comment-page-1/index.html#comment-3095"><time datetime="2008-10-21T22:45:35+00:00">October 21, 2008 at 10:45 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Why aren&#8217;t these optimizations directly injected into the Rhino project, it would be very helpful?</p>
							</section><!-- .comment-content -->

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-3096">
		<article id="comment-3096" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/13753e40e0a6a2ef6b0652e1e05b0af0?s=44&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/13753e40e0a6a2ef6b0652e1e05b0af0?s=88&amp;d=mm&amp;r=g 2x' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Thomas Broyer</b> </cite><a href="comment-page-1/index.html#comment-3096"><time datetime="2008-10-22T01:11:01+00:00">October 22, 2008 at 1:11 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Wouldn&#8217;t it have been much easier to just change the modified-Rhino package name? Just like  for instance the Xalan version included in recent JREs live in com.sun.org.apache.xalan.internal. GWT uses a modified Rhino parser too, which lives in the com.google.gwt.dev.js.rhino package.</p>
							</section><!-- .comment-content -->

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment byuser comment-author-admin bypostauthor even thread-even depth-1" id="li-comment-3101">
		<article id="comment-3101" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://2.gravatar.com/avatar/8233cc93c34d23ce58c0096fb07375c0?s=44&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/8233cc93c34d23ce58c0096fb07375c0?s=88&amp;d=mm&amp;r=g 2x' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn"><a href='../../../../index.html' rel='external nofollow' class='url'>Julien Lecomte</a></b> <span>Post author</span></cite><a href="comment-page-1/index.html#comment-3101"><time datetime="2008-10-22T08:17:20+00:00">October 22, 2008 at 8:17 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>@JY</p>
<p>As a reference implementation, Rhino must stick as close as possible to standard ECMAScript. The changes I made to the parser are to accommodate the more relaxed syntax supported by modern web browsers, and to support features that aren&#8217;t part of the standard.</p>
<p>@Thomas</p>
<p>My goal was to modify the smallest possible number of files from the Rhino distribution. That way, fixes in Rhino ca be easily backported into the YUI Compressor. Moreover, using a class loader is a slightly more elegant (not to say funner) solution!</p>
							</section><!-- .comment-content -->

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-3123">
		<article id="comment-3123" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/f24c37966ae820babbc010d40e08e607?s=44&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/f24c37966ae820babbc010d40e08e607?s=88&amp;d=mm&amp;r=g 2x' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn"><a href='http://www.outwit.com' rel='external nofollow' class='url'>Pierre Réveillon</a></b> </cite><a href="comment-page-1/index.html#comment-3123"><time datetime="2008-11-04T07:27:31+00:00">November 4, 2008 at 7:27 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Hello,</p>
<p>Do you plan to support Javascript 1.7 features in a future version?<br />
We are using the compressor for a Firefox extension, and we use a lot of JS 1.7/1.8.</p>
<p>Thanks.</p>
							</section><!-- .comment-content -->

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-3153">
		<article id="comment-3153" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/cc1a6a7b25c5ff69256e40bce2f75672?s=44&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/cc1a6a7b25c5ff69256e40bce2f75672?s=88&amp;d=mm&amp;r=g 2x' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Lowell Stewart</b> </cite><a href="comment-page-1/index.html#comment-3153"><time datetime="2008-11-24T08:05:09+00:00">November 24, 2008 at 8:05 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Hello, and thanks for all your work on YUI Compressor!  Seems to be very useful and solid, and I was excited to try it on some very large scripts I&#8217;ve written.</p>
<p>One problem I have found, though, is that Rhino (apparently) chokes on the &#8220;debugger&#8221; keyword in JavaScript.  I have some scripts that, under certain circumstances, execute the debugger keyword to force a breakpoint and activation of a JavaScript debugger (if present) &#8212; i.e. as a developer, if I&#8217;m testing my JavaScript while it&#8217;s running in an instance of IE embedded in another application, and I need to get in and inspect the DOM or the state of my code, I set things up such that I can give the code some secret input (in my case I click a certain button with Ctrl+Shift held down), which triggers execution of the debugger keyword. This causes the embedded instance of IE to invoke my JS debugger &#8212; it&#8217;s very useful in some cases.</p>
<p>When YUIC encounters the debugger keyword in JavaScript, though, it reports the following syntax error:</p>
<p>[ERROR] xxx:yy:identifier is a reserved word<br />
&#8230;<br />
org.mozilla.javascript.EvaluatorException: Compilation produced syntax error.<br />
        at com.yahoo.platform.yui.compressor.YUICompressor$1.runtimeError(YUICompressor.java:135)<br />
        at org.mozilla.javascript.Parser.parse(Parser.java:410)<br />
        at org.mozilla.javascript.Parser.parse(Parser.java:355)<br />
        at com.yahoo.platform.yui.compressor.JavaScriptCompressor.parse(JavaScriptCompressor.java:312)<br />
        at com.yahoo.platform.yui.compressor.JavaScriptCompressor.(JavaScriptCompressor.java:533)<br />
        at com.yahoo.platform.yui.compressor.YUICompressor.main(YUICompressor.java:112)<br />
        at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)<br />
        at sun.reflect.NativeMethodAccessorImpl.invoke(Unknown Source)<br />
        at sun.reflect.DelegatingMethodAccessorImpl.invoke(Unknown Source)<br />
        at java.lang.reflect.Method.invoke(Unknown Source)<br />
        at com.yahoo.platform.yui.compressor.Bootstrap.main(Bootstrap.java:20)</p>
<p>Seems like &#8220;debugger&#8221; is on a list of reserved words that Rhino is aware or, but at the same time it doesn&#8217;t expect to ever find it in a script.  As I said, it executes perfectly well under Internet Explorer; it&#8217;s also documented as working in Mozilla &amp; derivatives. Any chance you&#8217;d consider (further) modifying Rhino to accept the debugger keyword?</p>
							</section><!-- .comment-content -->

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-3216">
		<article id="comment-3216" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/935f8ec51cf886b8af3d1ef7a9cbf346?s=44&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/935f8ec51cf886b8af3d1ef7a9cbf346?s=88&amp;d=mm&amp;r=g 2x' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Eric</b> </cite><a href="comment-page-1/index.html#comment-3216"><time datetime="2009-02-23T15:13:01+00:00">February 23, 2009 at 3:13 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Hi,</p>
<p>Is there a bug tracking site for YUICompressor?  Generally, it looks like it is working fairly well, but I am seeing a JS file fail miserably even though the JS is all valid.  Is there anywhere to report this issue?</p>
<p>The JS file in question that YUICompressor is choking over is from the jQuery Rich Array plugin (<a href="http://vladimir-k.blogspot.com/2008/12/rich-array-jquery-plugin.html" rel="nofollow">http://vladimir-k.blogspot.com/2008/12/rich-array-jquery-plugin.html</a>).  The source can be found at <a href="http://jquery-rich-array.googlecode.com/files/rich-array-package-0.0.1.zip" rel="nofollow">http://jquery-rich-array.googlecode.com/files/rich-array-package-0.0.1.zip</a>.  </p>
<p>Is there something special about this JS that the Compressor would find faulty?</p>
<p>Thanks,</p>
<p>Eric</p>
							</section><!-- .comment-content -->

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-3223">
		<article id="comment-3223" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://1.gravatar.com/avatar/d1ed96daf84c889ea0b4719a9738dade?s=44&#038;d=mm&#038;r=g' srcset='http://1.gravatar.com/avatar/d1ed96daf84c889ea0b4719a9738dade?s=88&amp;d=mm&amp;r=g 2x' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn"><a href='http://www.extremefx.com.ar' rel='external nofollow' class='url'>Marcelo Volmaro</a></b> </cite><a href="comment-page-1/index.html#comment-3223"><time datetime="2009-02-26T05:22:24+00:00">February 26, 2009 at 5:22 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Hi,</p>
<p>It may be possible to add another option to the compressor so ANYTHING that start with an underscore will be replaced like any scoped variable (much like Dean Edwards js compressor).</p>
<p>Also, it would be nice another option (if I ask, I ask a lot :) ) to force variable replacement, even when the compressor finds an eval? Of course that may be dangerous if you don&#8217;t know what you are doing, but I have some specifics where I needed eval and I&#8217;m sure what happens inside the eval will not break because of an invalid referenced variable (like parsing json data or handling conditional comments for explorer).</p>
<p>Thanks in advance,</p>
<p>Marcelo.</p>
							</section><!-- .comment-content -->

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-3269">
		<article id="comment-3269" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://2.gravatar.com/avatar/2104e883cc1c277620120b898f72a75f?s=44&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/2104e883cc1c277620120b898f72a75f?s=88&amp;d=mm&amp;r=g 2x' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Mike P</b> </cite><a href="comment-page-1/index.html#comment-3269"><time datetime="2009-04-17T13:17:11+00:00">April 17, 2009 at 1:17 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>First off, I love YUI, and the compressor.  Nice work!</p>
<p>My question:<br />
I&#8217;m trying to automate the &#8220;minification&#8221; of my site&#8217;s files using a Java app.  I basically took the code from YUICompressor.java and hacked it to fit my needs.  It almost works, but when my files are minified they are truncated at 8192 bytes (8k).</p>
<p>As an experiment I took my input stream and wrote it directly to my output stream and I get the full file contents.  It&#8217;s only when I call JavaScriptCompressor&#8217;s compress() method that the file gets truncated.  </p>
<p>Any suggestions?  It even gets truncated if I use System.out as my output stream.  I&#8217;m baffled.</p>
<p>Thanks!</p>
							</section><!-- .comment-content -->

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-3275">
		<article id="comment-3275" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://2.gravatar.com/avatar/2104e883cc1c277620120b898f72a75f?s=44&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/2104e883cc1c277620120b898f72a75f?s=88&amp;d=mm&amp;r=g 2x' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Mike P</b> </cite><a href="comment-page-1/index.html#comment-3275"><time datetime="2009-04-20T08:58:59+00:00">April 20, 2009 at 8:58 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Answered my own question.  I was using a ByteArrayOutputStream and accidentally calling &#8220;.flush()&#8221; for the stream itself rather than the stream writer before trying to convert the results to a string.  Changed one line of code and it&#8217;s all working now.  </p>
<p>Thanks again for a great utility!</p>
							</section><!-- .comment-content -->

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-3297">
		<article id="comment-3297" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/6accd310c54b75eb3ddfc15aa90911f4?s=44&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/6accd310c54b75eb3ddfc15aa90911f4?s=88&amp;d=mm&amp;r=g 2x' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Dean</b> </cite><a href="comment-page-1/index.html#comment-3297"><time datetime="2009-05-21T13:04:26+00:00">May 21, 2009 at 1:04 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>I am having the same issues as Lowell and Eric.  I am getting the exception org.mozilla.javascript.EvaluatorException while using a jQuery plugin which works on the browsers I&#8217;ve tested (IE[6,7] and FF)</p>
<p>Any work arounds?</p>
							</section><!-- .comment-content -->

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-3298">
		<article id="comment-3298" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/6accd310c54b75eb3ddfc15aa90911f4?s=44&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/6accd310c54b75eb3ddfc15aa90911f4?s=88&amp;d=mm&amp;r=g 2x' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Dean</b> </cite><a href="comment-page-1/index.html#comment-3298"><time datetime="2009-05-21T13:56:36+00:00">May 21, 2009 at 1:56 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>I narrowed my issue down to two scripts<br />
1. jquery-however-intent.min.js<br />
2. jquery.blockUI.js</p>
<p>Anyone else have this issue and figured out a way to resolve it?</p>
							</section><!-- .comment-content -->

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-3559">
		<article id="comment-3559" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://2.gravatar.com/avatar/be66171852f90201dcfdc58fc38d5688?s=44&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/be66171852f90201dcfdc58fc38d5688?s=88&amp;d=mm&amp;r=g 2x' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">endium</b> </cite><a href="comment-page-1/index.html#comment-3559"><time datetime="2009-08-24T15:09:23+00:00">August 24, 2009 at 3:09 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>The bootstrapping works fine when executing the jar like normal, but I&#8217;m calling the compress method directly, like this:<br />
JavaScriptCompressor compressor = new JavaScriptCompressor(in, e_reporter);<br />
compressor.compress(out, -1, false, true, true, false);</p>
<p>I had to add the regular js.jar into the classpath for a new project i&#8217;m working on, and now the compressor isn&#8217;t working properly any more. Any ideas?</p>
							</section><!-- .comment-content -->

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-3607">
		<article id="comment-3607" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/95ba52691611fe835cdfb360b4c7b77d?s=44&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/95ba52691611fe835cdfb360b4c7b77d?s=88&amp;d=mm&amp;r=g 2x' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn"><a href='http://www.richdougherty.com/' rel='external nofollow' class='url'>Rich Dougherty</a></b> </cite><a href="comment-page-1/index.html#comment-3607"><time datetime="2009-08-30T17:47:27+00:00">August 30, 2009 at 5:47 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>In WebSphere 6.0 Rhino is provided in the parent classloader so I found it was necessary to rename packages (as suggested by Thomas Broyer). It is possible to automate this operation. Anyone interested should check out the solution used by the Liferay project. I am not affiliated with Liferay, but I found their scripts very helpful.</p>
<p><a href="http://issues.liferay.com/browse/LPS-3169?page=com.atlassian.jira.plugin.system.issuetabpanels%3Aall-tabpanel" rel="nofollow">http://issues.liferay.com/browse/LPS-3169?page=com.atlassian.jira.plugin.system.issuetabpanels%3Aall-tabpanel</a></p>
							</section><!-- .comment-content -->

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="comment odd alt thread-odd thread-alt depth-1" id="li-comment-4150">
		<article id="comment-4150" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://2.gravatar.com/avatar/2eb47fde10381e6eb18f9a760fa1b166?s=44&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/2eb47fde10381e6eb18f9a760fa1b166?s=88&amp;d=mm&amp;r=g 2x' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Andrey</b> </cite><a href="comment-page-1/index.html#comment-4150"><time datetime="2010-03-03T05:07:01+00:00">March 3, 2010 at 5:07 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Dean, I&#8217;ve fixed the issue with jquery.blockUI.js If no charset paramis specified for YUICompressor then it use system default encoding (which is ISO-8859-1 for me) but original jquery.blockUI.js have UTF-8 encoding. So you should converte this file to the system default encoding (e.g. ISO-8859-1) or explicitly setting YUICompressor charset param to the UTF-8 for this file.</p>
							</section><!-- .comment-content -->

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
		</ol><!-- .commentlist -->

		
				<p class="nocomments">Comments are closed.</p>
		
	
	
</div><!-- #comments .comments-area -->
			
		</div><!-- #content -->
	</div><!-- #primary -->


		<script type="text/javascript">
		window.onload = function(){prettyPrint();};
	</script>
	</div><!-- #main .wrapper -->
	<footer id="colophon" role="contentinfo">
		<div class="site-info">
						<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform">Proudly powered by WordPress</a>
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type="text/javascript">
// <![CDATA[
// ]]>
</script>
<script type='text/javascript' src='../../../wp-content/themes/twentytwelve/js/navigation.js'></script>
</body>
</html>
