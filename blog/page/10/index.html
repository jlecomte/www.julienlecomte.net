<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) & !(IE 8)]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>Julien Lecomte&#039;s Blog | Woodworking, Amateur Astronomy, Web Development and Operating System Programming. | Page 10</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="http://www.julienlecomte.net/blog/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="http://www.julienlecomte.net/blog/wp-content/themes/twentytwelve/js/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel="alternate" type="application/rss+xml" title="Julien Lecomte&#039;s Blog &raquo; Feed" href="../../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Julien Lecomte&#039;s Blog &raquo; Comments Feed" href="../../comments/feed/index.html" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"http:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/www.julienlecomte.net\/blog\/wp-includes\/js\/wp-emoji-release.min.js"}};
			!function(a,b,c){function d(a){var c=b.createElement("canvas"),d=c.getContext&&c.getContext("2d");return d&&d.fillText?(d.textBaseline="top",d.font="600 32px Arial","flag"===a?(d.fillText(String.fromCharCode(55356,56812,55356,56807),0,0),c.toDataURL().length>3e3):(d.fillText(String.fromCharCode(55357,56835),0,0),0!==d.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='colorbox-theme1-css'  href='../../wp-content/plugins/jquery-lightbox-for-native-galleries/colorbox/theme1/colorbox.css' type='text/css' media='screen' />
<link rel='stylesheet' id='twentytwelve-fonts-css'  href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700&#038;subset=latin,latin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-style-css'  href='../../wp-content/themes/twentytwelve/style.css' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentytwelve-ie-css'  href='http://www.julienlecomte.net/blog/wp-content/themes/twentytwelve/css/ie.css' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='../../wp-includes/js/jquery/jquery.js'></script>
<script type='text/javascript' src='../../wp-includes/js/jquery/jquery-migrate.min.js'></script>
<script type='text/javascript' src='../../wp-content/plugins/jquery-lightbox-for-native-galleries/colorbox/jquery.colorbox-min.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../wp-includes/wlwmanifest.xml" /> 
<meta name="generator" content="WordPress 4.3" />
	<link href="../../wp-content/plugins/google-code-prettify/prettify.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="../../wp-content/plugins/google-code-prettify/prettify.js"></script>
	<!-- jQuery Lightbox For Native Galleries v3.2.2 | http://www.viper007bond.com/wordpress-plugins/jquery-lightbox-for-native-galleries/ -->
<script type="text/javascript">
// <![CDATA[
	jQuery(document).ready(function($){
		$(".gallery").each(function(index, obj){
			var galleryid = Math.floor(Math.random()*10000);
			$(obj).find("a").colorbox({rel:galleryid, maxWidth:"95%", maxHeight:"95%"});
		});
		$("a.lightbox").colorbox({maxWidth:"95%", maxHeight:"95%"});
	});
// ]]>
</script>
</head>

<body class="home blog paged paged-10 full-width custom-font-enabled single-author">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
		<hgroup>
			<h1 class="site-title"><a href="../../../index.html" title="Julien Lecomte&#039;s Blog" rel="home">Julien Lecomte&#039;s Blog</a></h1>
			<h2 class="site-description">Woodworking, Amateur Astronomy, Web Development and Operating System Programming.</h2>
		</hgroup>

		<nav id="site-navigation" class="main-navigation" role="navigation">
			<button class="menu-toggle">Menu</button>
			<a class="assistive-text" href="index.html#content" title="Skip to content">Skip to content</a>
			<div class="nav-menu"><ul><li ><a href="../../../index.html">Home</a></li><li class="page_item page-item-36"><a href="../../index.html?p=36">About The Author</a></li></ul></div>
		</nav><!-- #site-navigation -->

			</header><!-- #masthead -->

	<div id="main" class="wrapper">
	<div id="primary" class="site-content">
		<div id="content" role="main">
		
										
	<article id="post-9" class="post-9 post type-post status-publish format-standard hentry category-web-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="../../2007/08/9/index.html" rel="bookmark">YUI-based Image Magnifier Widget</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><img src="../../../blogfiles/images/image-magnifier.thumbnail.jpg" style="float:left;margin-right:10px;width:250px;height:188px;"></p>
<p>I wrote a prototype YUI-based image magnifier widget that makes use of VML on Internet Explorer and the Canvas tag on all the other <a href="http://developer.yahoo.com/yui/articles/gbs/" target="_blank">A-grade browsers</a>. Attached is a screenshot.</p>
<p>To instantiate the widget, include the following source files in your web page (<strong>requires YUI >= 2.3</strong>)</p>
<p><br style="clear:both;"/></p>
<pre class="prettyprint">&#60;!-- CSS --&#62;
&#60;link rel="stylesheet" type="text/css" href="image-magnifier.css"&#62;

&#60;!-- Dependencies --&#62;
&#60;script src="yahoo-dom-event.js"&#62;&#60;/script&#62;
&#60;script src="dragdrop-min.js"&#62;&#60;/script&#62;

&#60;!-- Image cropper source file --&#62;
&#60;script src="image-magnifier-min.js"&#62;&#60;/script&#62;
</pre>
<p>Then, place an image on your page:</p>
<pre class="prettyprint">&#60;img src="myImage.jpg" id="myImageId"&#62;</pre>
<p>Finally, instantiate the widget:</p>
<pre class="prettyprint">
&#60;script&#62;
    new YAHOO.widget.ImageMagnifier("myImageId", "magnified.jpg");
&#60;/script&#62;
</pre>
<p>Although this prototype is not extremely polished, it should work fairly well right out of the box. Here is a <a href="../../../blogfiles/image-magnifier/index.html" target="_blank">live demo of the image magnifier widget</a> (drag the lens around). You can also download an <a href="../../../blogfiles/image-magnifier/image-magnifier.zip">archive</a> containing all the necessary source code.</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="../../category/web-development/index.html" rel="category tag">Web Development</a> on <a href="../../2007/08/9/index.html" title="10:59 am" rel="bookmark"><time class="entry-date" datetime="2007-08-07T10:59:30+00:00">August 7, 2007</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../author/admin/index.html" title="View all posts by Julien Lecomte" rel="author">Julien Lecomte</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-8" class="post-8 post type-post status-publish format-standard hentry category-web-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="../../2007/07/8/index.html" rel="bookmark">Introducing iSearch, A Search Page Optimized For The iPhone</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><img src="../../../blogfiles/images/isearch-thumbnail.png" style="float:left;margin-right:10px;width:173px;height:233px;border:1px solid #aaa;padding:0;"></p>
<p>I hacked a search page optimized for the iPhone. It uses the <a href="http://developer.yahoo.com/search/" target="_blank">Yahoo! Search API</a> and bits of <a href="http://www.joehewitt.com/iui/" target="_blank">Joe Hewitt&#8217;s iUI library</a>. The address is:</p>
<p><a href="../../../isearch/index.html" target="_blank">http://www.julienlecomte.net/isearch/</a></p>
<p>Developing a web application for the iPhone is actually easier than traditional web development because of the fact that you are designing for a specific browser (Safari) running on a specific device with a known resolution (320 x 480)</p>
<p>I hope you&#8217;ll find this page useful. Comments and constructive criticism are welcome as always!</p>
<p><br style="clear:both;"/></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="../../category/web-development/index.html" rel="category tag">Web Development</a> on <a href="../../2007/07/8/index.html" title="10:45 pm" rel="bookmark"><time class="entry-date" datetime="2007-07-28T22:45:11+00:00">July 28, 2007</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../author/admin/index.html" title="View all posts by Julien Lecomte" rel="author">Julien Lecomte</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-7" class="post-7 post type-post status-publish format-standard hentry category-web-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="../../2007/07/7/index.html" rel="bookmark">Exposing Extension Functionality to Web-Page Javascript</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><img src="../../../blogfiles/images/firefox.png" style="float:right;width:60px;height:60px;border:none;padding:0;"></p>
<p style="padding-right:70px;">In this article, I describe how to implement a scriptable <a href="http://www.mozilla.org/projects/xpcom/book/cxc/" target="_blank">XPCOM Component</a>. This type of component exposes some extra functionality to untrusted web-page JavaScript running inside a Gecko-based browser such as Firefox. The implementation itself will be done in JavaScript.</p>
<p><br style="clear:both;"/></p>
<h4>Before we start</h4>
<p>First of all, you will need to download a recent version of the Mozilla source code. The Mozilla source code can be obtained either by downloading a source archive, or by using a CVS (source control) client. For our project, downloading a source archive is recommended, but if you wish to go down the CVS road, you should read this <a href="http://developer.mozilla.org/en/docs/Mozilla_Source_Code_Via_CVS" target="_blank">MDC article</a> first. In my case, I simply downloaded a <a href="http://mozilla.osuosl.org/pub/mozilla.org/firefox/releases/2.0.0.5/source/firefox-2.0.0.5-source.tar.bz2" target="_blank">tarball</a> of the Firefox 2.0.0.5 source code. Untar it using</p>
<pre>tar xjfv &#60;source-file.tar.bz2&#62;</pre>
<p>XPCOM uses its own variant of the CORBA OMG Interface Definition Language (IDL) called XPIDL. You will need a special compiler to process your XPIDL files. You can build the compiler yourself (the source for the compiler is under mozilla/xpcom/typelib/xpidl). If you&#8217;re on Windows (XP or Vista), you can simply download a statically linked Windows binary <a href="http://developer.mozilla.org/en/docs/User:Andywang:xpidl" target="_blank">here</a>.</p>
<h4>Define the component interface</h4>
<p>Let&#8217;s define the interface of our component. I will not delve into details about the actual XPIDL syntax. You can find more information on this <a href="http://developer.mozilla.org/en/docs/XPIDL:Syntax" target="_blank">here</a>. This interface resides in a file named <a href="../../../blogfiles/simple-xpcom/nsISimple.idl" target="_blank">nsSimple.idl</a>. The GUID was generated using <a href="http://search.yahoo.com/search?p=GUIDGen.exe" target="_blank">Microsoft&#8217;s GUIDGen.exe</a>.</p>
<pre class="prettyprint">
#include "nsISupports.idl"

[scriptable, uuid(B2A56E5E-CF18-4a8e-8EE9-CE228098516A)]
interface nsISimple : nsISupports {

    // Version string. Readonly!
    readonly attribute string version;

    // Dummy test function.
    string doSomething( in string value );
};
</pre>
<h4>Compile the interface file</h4>
<p>This file must be compiled using the XPIDL compiler using the following command line. This should generate a file name nsISimple.xpt.</p>
<pre style="overflow:auto;overflow-y:hidden;">
xpidl -m typelib -w -v -I &#60;path-to-mozilla-source&#62;/mozilla/xpcom/base -o nsISimple nsISimple.idl
</pre>
<h4>Interface implementation</h4>
<p>Once you have successfuly created an interface file that publicly defines the component&#8217;s methods and attributes, the next step is to implement those methods and attributes in a separate source file named <a href="../../../blogfiles/simple-xpcom/nsSimple.js" target="_blank">nsSimple.js</a>. The nsSimple object implements the nsISimple interface of course, but also the nsISupports interface (because nsISimple inherits from it) and the nsIClassInfo interface (this is needed because we are writing a scriptable component).</p>
<h4>Component registration and instantiation</h4>
<p>The second half of the file <a href="../../../blogfiles/simple-xpcom/nsSimple.js" target="_blank">nsSimple.js</a> contains the code necessary for the component instantiation and automatic registration. This code is fairly generic and does not change much from one component to another.</p>
<h4>Install the component and test it</h4>
<p>Copy the two files nsISimple.xpt and nsSimple.js to</p>
<pre>&#60;path-to-your-firefox-install&#62;/components/</pre>
<p>and restart Firefox. Create a simple HTML file as follows:</p>
<pre class="prettyprint">
&#60;html&#62;
  &#60;head&#62;
    &#60;title&#62;XPCOM test page&#60;/title&#62;
  &#60;/head&#62;
  &#60;body&#62;
    &#60;script&#62;

if (window.simpleObj) {
    alert(simpleObj.version);
    alert(simpleObj.doSomething("foo"));
}
    &#60;/script&#62;
  &#60;/body&#62;
&#60;/html&#62;
</pre>
<p>and open it up in Firefox. You should see a couple of alerts.</p>
<h4>Downloads</h4>
<p>I put together a complete <a href="../../../blogfiles/simple-xpcom/nsSimple.zip" target="_blank">archive</a> that contains all the necessary files.</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="../../category/web-development/index.html" rel="category tag">Web Development</a> on <a href="../../2007/07/7/index.html" title="9:56 am" rel="bookmark"><time class="entry-date" datetime="2007-07-26T09:56:02+00:00">July 26, 2007</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../author/admin/index.html" title="View all posts by Julien Lecomte" rel="author">Julien Lecomte</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-6" class="post-6 post type-post status-publish format-standard hentry category-web-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="../../2007/07/6/index.html" rel="bookmark">YUI-based Image Cropper Widget</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><img src="../../../blogfiles/images/image-cropper.thumbnail.jpg" style="float:left;margin-right:10px;width:250px;height:188px;"></p>
<p>I wrote a YUI-based image cropper widget that allows you to easily select which region of an image you&#8217;d like to crop. This widget works on all <a href="http://developer.yahoo.com/yui/articles/gbs/" target="_blank">A-grade browsers</a>  in both standards mode and quirks mode. Attached is a screenshot.</p>
<p>To instantiate the widget, include the following source files in your web page (<strong>requires YUI >= 2.3</strong>)</p>
<p><br style="clear:both;"/></p>
<pre class="prettyprint">&#60;!-- CSS --&#62;
&#60;link rel="stylesheet" type="text/css" href="image-cropper.css"&#62;

&#60;!-- Dependencies --&#62;
&#60;script src="yahoo-dom-event.js"&#62;&#60;/script&#62;
&#60;script src="dragdrop-min.js"&#62;&#60;/script&#62;

&#60;!-- Image cropper source file --&#62;
&#60;script src="image-cropper-min.js"&#62;&#60;/script&#62;
</pre>
<p>Then, place an image on your page:</p>
<pre class="prettyprint">&#60;img src="myImage.jpg" id="myImageId"&#62;</pre>
<p>Finally, instantiate the widget:</p>
<pre class="prettyprint">
&#60;script&#62;
    var cropper = new YAHOO.widget.ImageCropper("myImageId");
&#60;/script&#62;
</pre>
<p>You can then retrieve the geometry of the crop region by calling:</p>
<pre class="prettyprint">
var region = cropper.getCropRegion();
</pre>
<p>This should work right out of the box. You can also pass an optional configuration object to the constructor to set the initial geometry of the crop region as well as a constraint on the ratio width / height. For more information, please refer to the documentation inline in the source code.</p>
<p>Here is a <a href="../../../blogfiles/image-cropper/index.html" target="_blank">live demo of the image cropper widget</a>. You can also download an <a href="../../../blogfiles/image-cropper/image-cropper.zip">archive</a> containing all the necessary source code.</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="../../category/web-development/index.html" rel="category tag">Web Development</a> on <a href="../../2007/07/6/index.html" title="4:49 pm" rel="bookmark"><time class="entry-date" datetime="2007-07-24T16:49:32+00:00">July 24, 2007</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../author/admin/index.html" title="View all posts by Julien Lecomte" rel="author">Julien Lecomte</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-4" class="post-4 post type-post status-publish format-standard hentry category-web-development">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="../../2007/07/4/index.html" rel="bookmark">IE6, CSS Sprites and Alpha Transparency</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>Image slicing using CSS, also known as <a href="http://www.alistapart.com/articles/sprites" target="_blank">CSS sprites</a>, is quickly becoming a very popular technique in web development as it can dramatically improve the performance of a site by reducing the number of HTTP requests (see <a href="http://yuiblog.com/blog/2006/11/28/performance-research-part-1/" target="_blank">this article</a> for more information). Alpha transparency is also quickly becoming a favorite feature among web designers: nice transparent gradients, no more jagged edges, etc. What&#8217;s not to like?</p>
<p>The good news is that almost all browsers in the <a href="http://developer.yahoo.com/yui/articles/gbs/" target="_blank">A-grade category</a> support alpha transparency via the use of PNG. The bad news is that IE6 does not support alpha transparency natively. It requires the use of a filter involving the <a href="http://msdn2.microsoft.com/en-us/library/ms532969.aspx" target="_blank">AlphaImageLoader</a> activeX, which does not support background repeat or positioning, the heart of the traditional CSS sprites technique.</p>
<p>The traditional CSS sprites technique relies on the ability to control the background properties of an appropriately sized HTML element, masking out all but the needed part of the larger background image. I recently heard of another technique that instead relies on clipping. Here is the recipe:</p>
<ul>
<li>Create a block element (a DIV for example)</li>
<li>Set its size to the same size as the large image used for the sprite.</li>
<li>Set its background image.</li>
<li>Clip it to show only a small portion of the sprite.</li>
<li>Finally, position it appropriately.</li>
</ul>
<p>The following example masks all but a 50 x 50 px portion of the master image:</p>
<pre class="prettyprint">
#myDiv {
   width:400px; height:300px;
   background:url(sprite.png);
   clip:rect(100px,250px,150px,100px);
   position:absolute;
}
</pre>
<p>Unlike the traditional CSS sprites technique, this new technique can be used with the AlphaImageLoader filter to create alpha transparent sprites on IE6. Simply replace the line:</p>
<pre class="prettyprint">background:url(sprite.png);</pre>
<p>with:</p>
<pre class="prettyprint">
filter:progid:DXImageTransform.Microsoft.AlphaImageLoader(<span class="cr">&crarr;</span>
    src="sprite.png", sizingMethod="scale");</pre>
<p>This technique does not offer any support for background repeat. However, if you only use patterns that can be stretched either horizontally or vertically, you can still use this technique. I put together a <a href="../../../blogfiles/ie6-alpha-transparency-sprites/index.html" target="_blank">complete demo</a> to illustrate this.</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="../../category/web-development/index.html" rel="category tag">Web Development</a> on <a href="../../2007/07/4/index.html" title="9:02 pm" rel="bookmark"><time class="entry-date" datetime="2007-07-23T21:02:24+00:00">July 23, 2007</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../author/admin/index.html" title="View all posts by Julien Lecomte" rel="author">Julien Lecomte</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
							
	<article id="post-3" class="post-3 post type-post status-publish format-standard hentry category-system-programming">
				<header class="entry-header">
			
						<h1 class="entry-title">
				<a href="../../2007/07/3/index.html" rel="bookmark">How to make a Bochs disk image</a>
			</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p>In this article, I try to synthesize several (incomplete or inaccurate) articles I&#8217;ve found on the Internet to guide you through the process of creating a disk image you may use with the <a href="http://bochs.sourceforge.net/" target="_blank">Bochs emulator</a>. The steps described below are intended for a GNU/Linux system and some of them require super user privileges. Also, you need to have GRUB installed on your system.</p>
<p>1. Create a disk image. Here, I create a file named disk.img, containing 10080 blocks (each block being 512 bytes, this will create a file that&#8217;s about 5MB)</p>
<pre>$ dd if=/dev/zero of=disk.img count=10080</pre>
<p>2. Use FDISK to create a partition table on the image file:</p>
<pre>$ fdisk disk.img

   x     -> Extra functionality
   c 10  -> 10 cylinders
   h 16  -> 16 heads
   s 63  -> 63 sectors per track
   r     -> Return to main menu
   n     -> Create a new partition
   p     -> Primary
   1     -> Partition #1
   1     -> First cylinder
   10    -> Last cylinder
   a     -> Set bootable flag
   1     -> Partition number
   w     -> Write partition to disk</pre>
<p>Note that you have to tell fdisk about the geometry of your disk, and that geometry has to match the size of the disk you created in step 1 (10 cylinders * 16 heads * 63 sectors per track = 10080 blocks). For an introduction on disk geometry, cylinders, heads and sectors, read this <a href="http://en.wikipedia.org/wiki/Cylinder-head-sector" target="_blank">Wikipedia article</a>.</p>
<p>Let&#8217;s take a quick look at the Partition Table in the Master Boot Record (See <a href="http://en.wikipedia.org/wiki/Master_Boot_Record" target="_blank">this Wikipedia article</a> for a description of the structure of the partition table)</p>
<pre>$ hexdump disk.img</pre>
<p>The 16 bytes at offset 446 (0x1BE) are:</p>
<pre>0180 0001 0f83 093f 003f 0000 2721 0000</pre>
<p>Keep in mind that these values are stored using little-endian convention (see this <a href="http://en.wikipedia.org/wiki/Endianness" target="_blank">Wikipedia article</a> to find out more about the meaning of endianness in computer science). Also see <a href="http://thestarman.pcministry.com/asm/mbr/PartTables.htm" target="_blank">this article</a> to find out how the CHS values are computed.</p>
<table border="1">
<thead style="background:#ccc">
<tr>
<th>Offset</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td>0x00</td>
<td>0x80 means that this partition is bootable</td>
</tr>
<tr>
<td>0x01</td>
<td>0x000101 is the CHS address of the first sector in the partition:<br />S = 0x01 = 1<br />H = 0x01 = 1<br />C = 0x00 =  0</td>
</tr>
<tr>
<td>0x04</td>
<td>0x83 is the type of the partition (Linux native here)</td>
</tr>
<tr>
<td>0x05</td>
<td>0x093f0f is the CHS address of the last sector in the partition:<br />S = 0x3F = 63<br />H = 0x0F = 15<br />C = 0x09 =  9</td>
</tr>
<tr>
<td>0x08</td>
<td>0x0000003f (63) is the logical block address of the first sector in the partition</td>
</tr>
<tr>
<td>0x0C</td>
<td>0x00002721 (10017 = 10080 &#8211; 63) is the size of the partition, in number of 512 byte blocks</td>
</tr>
</tbody>
</table>
<p>3. Setup the loopback device. In order to do this, you need to calculate the offset (in bytes) of the first sector of your single partition. Use the following command:</p>
<pre>$ fdisk -l -u disk.img

  Device Boot      Start         End      Blocks   Id  System
disk.img1   *          63       10079        5008+  83  Linux</pre>
<p>This tells us that our single partition starts at the 63rd block. Hence our offset is 63 * 512 = 32256.</p>
<p>Finally, type:</p>
<pre>$ losetup -o 32256 /dev/loop0 disk.img</pre>
<p>4. Format the disk (EXT2FS)</p>
<pre>$ mkfs.ext2 /dev/loop0</pre>
<p>5. Mount the disk:</p>
<pre>$ mount -o loop /dev/loop0 /mnt</pre>
<p>6. Now, let&#8217;s install GRUB. Start by copying the necessary GRUB files:</p>
<pre>$ mkdir -p /mnt/boot/grub
$ cp /boot/grub/stage1 /boot/grub/stage2 /mnt/boot/grub/
$ vi /mnt/boot/grub/grub.conf

   title=MyKernel
   root (hd0,0)
   kernel /mykernel</pre>
<p>7. Unmount the device:</p>
<pre>$ umount /mnt</pre>
<p>8. Detach the loopback device:</p>
<pre>$ losetup -d /dev/loop0</pre>
<p>9. Finish up the GRUB installation:</p>
<pre>$ grub --device-map=/dev/null

   device (hd0) disk.img
   geometry (hd0) 10 16 63
   root (hd0,0)
   setup (hd0)
   quit</pre>
<p>10. Setup your .bochsrc file in the same directory as your disk image:</p>
<pre style="overflow:auto;overflow-y:hidden;">megs: 32
romimage: file=/usr/local/share/bochs/BIOS-bochs-latest, address=0xf0000
vgaromimage: file=/usr/local/share/bochs/VGABIOS-elpin-2.40
ata0-master: type=disk, path="disk.img", mode=flat, cylinders=10, heads=16, spt=63
cpu: count=1, ips=15000000
mouse: enabled=0
log: out.bochs
boot: disk</pre>
<p>That&#8217;s it. Start Bochs and the GRUB interface should appear:</p>
<p><a href='../../../blogfiles/images/grub.png' title='Bochs emulator showing GRUB'><img src='../../../blogfiles/images/grub.thumbnail.png' alt='Bochs emulator showing GRUB' /></a></p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="../../category/system-programming/index.html" rel="category tag">System Programming</a> on <a href="../../2007/07/3/index.html" title="8:57 pm" rel="bookmark"><time class="entry-date" datetime="2007-07-23T20:57:49+00:00">July 23, 2007</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../author/admin/index.html" title="View all posts by Julien Lecomte" rel="author">Julien Lecomte</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->
			
					<nav id="nav-below" class="navigation" role="navigation">
			<h3 class="assistive-text">Post navigation</h3>
			<div class="nav-previous"></div>
			<div class="nav-next"><a href="../9/index.html" >Newer posts <span class="meta-nav">&rarr;</span></a></div>
		</nav><!-- #nav-below .navigation -->
	
		
		</div><!-- #content -->
	</div><!-- #primary -->


		<script type="text/javascript">
		window.onload = function(){prettyPrint();};
	</script>
	</div><!-- #main .wrapper -->
	<footer id="colophon" role="contentinfo">
		<div class="site-info">
						<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform">Proudly powered by WordPress</a>
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type="text/javascript">
// <![CDATA[
// ]]>
</script>
<script type='text/javascript' src='../../wp-content/themes/twentytwelve/js/navigation.js'></script>
</body>
</html>
