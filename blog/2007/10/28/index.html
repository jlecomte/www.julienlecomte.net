<!DOCTYPE html>
<!--[if IE 7]>
<html class="ie ie7" lang="en-US">
<![endif]-->
<!--[if IE 8]>
<html class="ie ie8" lang="en-US">
<![endif]-->
<!--[if !(IE 7) & !(IE 8)]><!-->
<html lang="en-US">
<!--<![endif]-->
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width" />
<title>Running CPU Intensive JavaScript Computations in a Web Browser | Julien Lecomte&#039;s Blog</title>
<link rel="profile" href="http://gmpg.org/xfn/11" />
<link rel="pingback" href="http://www.julienlecomte.net/blog/xmlrpc.php" />
<!--[if lt IE 9]>
<script src="http://www.julienlecomte.net/blog/wp-content/themes/twentytwelve/js/html5.js" type="text/javascript"></script>
<![endif]-->
<link rel="alternate" type="application/rss+xml" title="Julien Lecomte&#039;s Blog &raquo; Feed" href="../../../feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Julien Lecomte&#039;s Blog &raquo; Comments Feed" href="../../../comments/feed/index.html" />
<link rel="alternate" type="application/rss+xml" title="Julien Lecomte&#039;s Blog &raquo; Running CPU Intensive JavaScript Computations in a Web Browser Comments Feed" href="feed/index.html" />
		<script type="text/javascript">
			window._wpemojiSettings = {"baseUrl":"http:\/\/s.w.org\/images\/core\/emoji\/72x72\/","ext":".png","source":{"concatemoji":"http:\/\/www.julienlecomte.net\/blog\/wp-includes\/js\/wp-emoji-release.min.js"}};
			!function(a,b,c){function d(a){var c=b.createElement("canvas"),d=c.getContext&&c.getContext("2d");return d&&d.fillText?(d.textBaseline="top",d.font="600 32px Arial","flag"===a?(d.fillText(String.fromCharCode(55356,56812,55356,56807),0,0),c.toDataURL().length>3e3):(d.fillText(String.fromCharCode(55357,56835),0,0),0!==d.getImageData(16,16,1,1).data[0])):!1}function e(a){var c=b.createElement("script");c.src=a,c.type="text/javascript",b.getElementsByTagName("head")[0].appendChild(c)}var f,g;c.supports={simple:d("simple"),flag:d("flag")},c.DOMReady=!1,c.readyCallback=function(){c.DOMReady=!0},c.supports.simple&&c.supports.flag||(g=function(){c.readyCallback()},b.addEventListener?(b.addEventListener("DOMContentLoaded",g,!1),a.addEventListener("load",g,!1)):(a.attachEvent("onload",g),b.attachEvent("onreadystatechange",function(){"complete"===b.readyState&&c.readyCallback()})),f=c.source||{},f.concatemoji?e(f.concatemoji):f.wpemoji&&f.twemoji&&(e(f.twemoji),e(f.wpemoji)))}(window,document,window._wpemojiSettings);
		</script>
		<style type="text/css">
img.wp-smiley,
img.emoji {
	display: inline !important;
	border: none !important;
	box-shadow: none !important;
	height: 1em !important;
	width: 1em !important;
	margin: 0 .07em !important;
	vertical-align: -0.1em !important;
	background: none !important;
	padding: 0 !important;
}
</style>
<link rel='stylesheet' id='colorbox-theme1-css'  href='../../../wp-content/plugins/jquery-lightbox-for-native-galleries/colorbox/theme1/colorbox.css' type='text/css' media='screen' />
<link rel='stylesheet' id='twentytwelve-fonts-css'  href='http://fonts.googleapis.com/css?family=Open+Sans:400italic,700italic,400,700&#038;subset=latin,latin-ext' type='text/css' media='all' />
<link rel='stylesheet' id='twentytwelve-style-css'  href='../../../wp-content/themes/twentytwelve/style.css' type='text/css' media='all' />
<!--[if lt IE 9]>
<link rel='stylesheet' id='twentytwelve-ie-css'  href='http://www.julienlecomte.net/blog/wp-content/themes/twentytwelve/css/ie.css' type='text/css' media='all' />
<![endif]-->
<script type='text/javascript' src='../../../wp-includes/js/jquery/jquery.js'></script>
<script type='text/javascript' src='../../../wp-includes/js/jquery/jquery-migrate.min.js'></script>
<script type='text/javascript' src='../../../wp-content/plugins/jquery-lightbox-for-native-galleries/colorbox/jquery.colorbox-min.js'></script>
<link rel="EditURI" type="application/rsd+xml" title="RSD" href="../../../xmlrpc.php?rsd" />
<link rel="wlwmanifest" type="application/wlwmanifest+xml" href="../../../wp-includes/wlwmanifest.xml" /> 
<link rel='prev' title='The Birth Of Web 3.0' href='../../../index.html?p=26' />
<link rel='next' title='What happened to Gmail?' href='../../../index.html?p=29' />
<meta name="generator" content="WordPress 4.3" />
<link rel='canonical' href='../../../index.html?p=28' />
<link rel='shortlink' href='../../../index.html?p=28' />
	<link href="../../../wp-content/plugins/google-code-prettify/prettify.css" type="text/css" rel="stylesheet" />
    <script type="text/javascript" src="../../../wp-content/plugins/google-code-prettify/prettify.js"></script>
	<!-- jQuery Lightbox For Native Galleries v3.2.2 | http://www.viper007bond.com/wordpress-plugins/jquery-lightbox-for-native-galleries/ -->
<script type="text/javascript">
// <![CDATA[
	jQuery(document).ready(function($){
		$(".gallery").each(function(index, obj){
			var galleryid = Math.floor(Math.random()*10000);
			$(obj).find("a").colorbox({rel:galleryid, maxWidth:"95%", maxHeight:"95%"});
		});
		$("a.lightbox").colorbox({maxWidth:"95%", maxHeight:"95%"});
	});
// ]]>
</script>
</head>

<body class="single single-post postid-28 single-format-standard full-width custom-font-enabled single-author">
<div id="page" class="hfeed site">
	<header id="masthead" class="site-header" role="banner">
		<hgroup>
			<h1 class="site-title"><a href="../../../../index.html" title="Julien Lecomte&#039;s Blog" rel="home">Julien Lecomte&#039;s Blog</a></h1>
			<h2 class="site-description">Woodworking, Amateur Astronomy, Web Development and Operating System Programming.</h2>
		</hgroup>

		<nav id="site-navigation" class="main-navigation" role="navigation">
			<button class="menu-toggle">Menu</button>
			<a class="assistive-text" href="../../../index.html?p=28#content" title="Skip to content">Skip to content</a>
			<div class="nav-menu"><ul><li ><a href="../../../../index.html">Home</a></li><li class="page_item page-item-36"><a href="../../../index.html?p=36">About The Author</a></li></ul></div>
		</nav><!-- #site-navigation -->

			</header><!-- #masthead -->

	<div id="main" class="wrapper">
	<div id="primary" class="site-content">
		<div id="content" role="main">

			
				
	<article id="post-28" class="post-28 post type-post status-publish format-standard hentry category-web-development">
				<header class="entry-header">
			
						<h1 class="entry-title">Running CPU Intensive JavaScript Computations in a Web Browser</h1>
								</header><!-- .entry-header -->

				<div class="entry-content">
			<p><em>The pattern discussed below is a well known pattern that has been used for 10 years. The goal of this article is to present this pattern under a new light, and most importantly to discuss ways of reducing its overhead.</em></p>
<p>The biggest deterrent for running CPU intensive computations in a web browser is the fact that the entire browser user interface is frozen while a JavaScript thread is running. This means that under no circumstance should a script ever take more than 300 msec (at most) to complete. Breaking this rule inevitably leads to bad user experience.</p>
<p>Furthermore, in web browsers, JavaScript threads have a limited amount of time to complete (there can be either a static time limit &#8212; that&#8217;s the case of Mozilla based browsers &#8212; or some other limit such as a maximum number of elementary operations &#8212; that&#8217;s the case of Internet Explorer) If a script takes too long to complete, the user is presented with a dialog asking whether that script should be terminated.</p>
<p><a href="http://gears.google.com" target="_blank">Google Gears</a> provides the ability to run CPU intensive JavaScript code without the two aforementioned limitations. However, you cannot usually rely on the presence of Gears (in the future, I would like to see a solution like the Gears WorkerPool API as part of the standard browser API)</p>
<p>Fortunately, the <code>setTimeout</code> method of the global object allows us to execute code on a delay, giving the browser a chance to handle events and update the user interface, even if the timeout value passed to <code>setTimeout</code> is 0. This allows us to cut a long running process into smaller units of work, and chain them according to the following pattern:</p>
<pre class="prettyprint">
function doSomething (callbackFn [, additional arguments]) {
    // Initialize a few things here...
    (function () {
        // Do a little bit of work here...
        if (<em>termination condition</em>) {
            // We are done
            callbackFn();
        } else {
            // Process next chunk
            setTimeout(arguments.callee, 0);
        }
    })();
}
</pre>
<p>This pattern can also be slightly modified to accept a progress callback instead of a completion callback. This is especially useful when using a progress bar:</p>
<pre class="prettyprint">
function doSomething (progressFn [, additional arguments]) {
    // Initialize a few things here...
    (function () {
        // Do a little bit of work here...
        if (<em>continuation condition</em>) {
            // Inform the application of the progress
            progressFn(<em>value</em>, <em>total</em>);
            // Process next chunk
            setTimeout(arguments.callee, 0);
        }
    })();
}
</pre>
<p>This <a href="../../../../blogfiles/javascript/long-running-js-process.html" target="_blank">example</a> demonstrates the sorting of a fairly large array using this pattern.</p>
<p><strong>Notes:</strong></p>
<ol>
<li>This pattern has a lot of overhead i.e. the total amount of time required to complete a task can be far greater than the time it would take to run the same task uninterrupted.</li>
<li>The shorter each cycle, the greater the overhead, the more reactive the user interface, the greater the overall time required to complete the task.</li>
<li>If you can be sure that each iteration of your algorithm is of very short duration &#8212; say 10 msec, you may want to group several iterations within a single cycle to reduce the overhead. The decision whether to start the next cycle or continue with more iterations can be made based on how long the current cycle has been running. This <a href="../../../../blogfiles/javascript/long-running-js-process-optimized.html" target="_blank">example</a> demonstrates this technique. Although it uses the same sorting algorithm as the example above, notice how much faster it is, while still keeping the user interface perfectly reactive.</li>
<li><em>Never</em> pass a string to <code>setTimeout</code>! If you do, the browser needs to do an implicit <code>eval</code> <em>every time</em> the code is executed, which adds an incredible amount of completely unnecessary overhead.</li>
<li>If you manipulate global data, make sure that access to that data is synchronized since it could also be modified by another JavaScript thread running between two cycles of your task.</li>
</ol>
<p>Finally, consider running this kind of task on the server (though you&#8217;ll have to deal with serialization / deserialization and network latency, especially if the data set is large) Having to run CPU intensive computations on the client <em>might</em> be a sign of a deeper, more serious architectural problem with your application.</p>
					</div><!-- .entry-content -->
		
		<footer class="entry-meta">
			This entry was posted in <a href="../../../category/web-development/index.html" rel="category tag">Web Development</a> on <a href="../../../index.html?p=28" title="1:51 pm" rel="bookmark"><time class="entry-date" datetime="2007-10-25T13:51:05+00:00">October 25, 2007</time></a><span class="by-author"> by <span class="author vcard"><a class="url fn n" href="../../../author/admin/index.html" title="View all posts by Julien Lecomte" rel="author">Julien Lecomte</a></span></span>.								</footer><!-- .entry-meta -->
	</article><!-- #post -->

				<nav class="nav-single">
					<h3 class="assistive-text">Post navigation</h3>
					<span class="nav-previous"><a href="../../../index.html?p=26" rel="prev"><span class="meta-nav">&larr;</span> The Birth Of Web 3.0</a></span>
					<span class="nav-next"><a href="../../../index.html?p=29" rel="next">What happened to Gmail? <span class="meta-nav">&rarr;</span></a></span>
				</nav><!-- .nav-single -->

				
<div id="comments" class="comments-area">

	
			<h2 class="comments-title">
			5 thoughts on &ldquo;<span>Running CPU Intensive JavaScript Computations in a Web Browser</span>&rdquo;		</h2>

		<ol class="commentlist">
				<li class="pingback even thread-even depth-1" id="comment-569">
		<p>Pingback: <a href='http://www.ajaxgirl.com/2007/10/26/running-cpu-intensive-javascript-computations-in-a-web-browser/' rel='external nofollow' class='url'>Ajax Girl &raquo; Blog Archive &raquo; Running CPU Intensive JavaScript Computations in a Web Browser</a> </p>
	</li><!-- #comment-## -->
	<li class="pingback odd alt thread-odd thread-alt depth-1" id="comment-571">
		<p>Pingback: <a href='http://www.javascriptnews.com/javascript/running-cpu-intensive-javascript-computations-in-a-web-browser.html' rel='external nofollow' class='url'>Javascript News &raquo; Blog Archive &raquo; Running CPU Intensive JavaScript Computations in a Web Browser</a> </p>
	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-573">
		<article id="comment-573" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://2.gravatar.com/avatar/81e6ef539bd7bd8dcf5d7095a0daf2b9?s=44&#038;d=mm&#038;r=g' srcset='http://2.gravatar.com/avatar/81e6ef539bd7bd8dcf5d7095a0daf2b9?s=88&amp;d=mm&amp;r=g 2x' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn">Ryan Zielke</b> </cite><a href="comment-page-1/index.html#comment-573"><time datetime="2007-10-28T06:53:48+00:00">October 28, 2007 at 6:53 am</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Does this pattern have a name?</p>
							</section><!-- .comment-content -->

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
	<li class="pingback odd alt thread-odd thread-alt depth-1" id="comment-576">
		<p>Pingback: <a href='http://www.eternal.co.za/blog/?p=38' rel='external nofollow' class='url'>.eternal &raquo; Long running JavaScript tasks</a> </p>
	</li><!-- #comment-## -->
	<li class="comment even thread-even depth-1" id="li-comment-579">
		<article id="comment-579" class="comment">
			<header class="comment-meta comment-author vcard">
				<img alt='' src='http://0.gravatar.com/avatar/fede7405a0e4cd5722e0b85920a0728c?s=44&#038;d=mm&#038;r=g' srcset='http://0.gravatar.com/avatar/fede7405a0e4cd5722e0b85920a0728c?s=88&amp;d=mm&amp;r=g 2x' class='avatar avatar-44 photo' height='44' width='44' /><cite><b class="fn"><a href='http://andrewdupont.net' rel='external nofollow' class='url'>Andrew Dupont</a></b> </cite><a href="comment-page-1/index.html#comment-579"><time datetime="2007-10-29T21:55:46+00:00">October 29, 2007 at 9:55 pm</time></a>			</header><!-- .comment-meta -->

			
			<section class="comment-content comment">
				<p>Great write-up.</p>
<p>I&#8217;ve seen (and used) this pattern in the comparison tests for the CSS selector functions in JavaScript libraries (e.g., <a href="http://mootools.net/slickspeed/" rel="nofollow">Mootools&#8217; Slickspeed</a>). Without dividing the tests into batches and scheduling them with setTimeout, you&#8217;d hang the browser almost immediately and make the benchmarks meaningless.</p>
							</section><!-- .comment-content -->

			<div class="reply">
							</div><!-- .reply -->
		</article><!-- #comment-## -->
	</li><!-- #comment-## -->
		</ol><!-- .commentlist -->

		
				<p class="nocomments">Comments are closed.</p>
		
	
	
</div><!-- #comments .comments-area -->
			
		</div><!-- #content -->
	</div><!-- #primary -->


		<script type="text/javascript">
		window.onload = function(){prettyPrint();};
	</script>
	</div><!-- #main .wrapper -->
	<footer id="colophon" role="contentinfo">
		<div class="site-info">
						<a href="http://wordpress.org/" title="Semantic Personal Publishing Platform">Proudly powered by WordPress</a>
		</div><!-- .site-info -->
	</footer><!-- #colophon -->
</div><!-- #page -->

<script type="text/javascript">
// <![CDATA[
// ]]>
</script>
<script type='text/javascript' src='../../../wp-content/themes/twentytwelve/js/navigation.js'></script>
</body>
</html>
